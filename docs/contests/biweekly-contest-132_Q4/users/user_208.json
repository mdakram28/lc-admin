{
    "username": "hornedfoe",
    "submission": "class Solution{\n    class SegTree{\n        int[] tree;\n        public SegTree(int n){\n            tree = new int[2 * (1 << Integer.toString(n , 2).length()) - 1];\n        }\n        public int add(int x , int y , int z , int i , int v){\n            if(x > z || y < z) return tree[i];\n            if(x == y) return tree[i] = v;\n            int m = (x + y) / 2;\n            return tree[i] = Math.max(add(x , m , z , i * 2 + 1 , v) , add(m + 1 , y , z , i * 2 + 2 , v));\n        }\n        public int finder(int x , int y , int l , int r , int i){\n            if(x > r || y < l) return 0;\n            if(x >= l && y <= r) return tree[i];\n            int m = (x + y) / 2;\n            return Math.max(finder(x , m , l , r , i * 2 + 1) , finder(m + 1 , y , l , r , i * 2 + 2));\n        }\n    }   \n    public int maximumLength(int[] nums , int k){\n        Map<Integer , Integer> map = new HashMap<>();\n        int n = nums.length , c = 0 , dp[][] = new int[n][k + 1] , ret = 1;\n        PriorityQueue<Integer> p = new PriorityQueue<>();\n        for(int i : nums) p.offer(i);\n        for( ; p.peek() != null ; p.poll()){\n            if(!map.containsKey(p.peek())) map.put(p.peek() , c++);\n        }\n        SegTree[] s = new SegTree[k + 1];\n        for(int i = 0 ; i <= k ; i++) s[i] = new SegTree(c);\n        for(int i = 0 ; i < n ; i++) Arrays.fill(dp[i] , 1);\n        for(int i = 0 ; i < n ; i++) nums[i] = map.get(nums[i]);\n        for(int i = n - 1 ; i >= 0 ; i--){\n            for(int j = k ; j >= 0 ; j--){\n                dp[i][j] = Math.max(dp[i][j] , 1 + s[j].finder(0 , c - 1 , nums[i] , nums[i] , 0));\n                if(j > 0) dp[i][j] = Math.max(dp[i][j] , 1 + Math.max(s[j - 1].finder(0 , c - 1 , 0 , nums[i] - 1 , 0) , s[j - 1].finder(0 , c - 1 , nums[i] + 1 , c - 1 , 0)));\n                s[j].add(0 , c - 1 , nums[i] , 0 , dp[i][j]);\n                ret = Math.max(ret , dp[i][j]);\n            }\n        }\n        return ret;\n    }\n}\n",
    "submit_ts": 1717860967.0
}