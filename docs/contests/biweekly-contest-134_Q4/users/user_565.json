{
    "username": "Ivan_len",
    "submission": "template<class F>\nstruct segtree{\n    int cnt;\n    vector<F> t;\n\n    segtree(int cnt) : cnt(cnt) {\n        t.resize(2 * cnt);\n    }\n    \n    inline F merge(F a, F b) {\n        return a & b;\n    }\n    \n    void build() {\n        for (int i = cnt - 1; i > 0; --i) {\n            t[i] = merge(t[i<<1], t[i<<1|1]);\n        }\n    }\n    \n    void modify(int p, F value) {\n        p += cnt;\n        t[p] = value;\n        for (p; p > 1; p >>= 1) t[p>>1] = (p&1?merge(t[p^1], t[p]):merge(t[p], t[p^1]));\n    }\n    \n    F query(int l, int r) {\n        F resl = (1 << 30) - 1, resr = (1 << 30) - 1;\n        for (l += cnt, r += cnt; l < r; l >>= 1, r >>= 1) {\n            if (l&1) resl = merge(resl, t[l++]);\n            if (r&1) resr = merge(t[--r], resr);\n        }\n        return merge(resl, resr);\n    }\n};\n\nclass Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        int n = nums.size();\n        long long ans = 0;\n        segtree<int> T(n);\n        for (int i = 0; i < n; i++) T.t[i + n] = nums[i];\n        T.build();\n        for (int i = 0; i < n; i++) {\n            if (nums[i] < k) continue;\n            int l = i, r = n;\n            while (l + 1 < r) {\n                int m = (l + r) / 2;\n                if (T.query(i, m + 1) >= k) l = m;\n                else r = m;\n            }\n            auto tmp = T.query(i, l + 1);\n            assert(tmp >= k);\n            if (tmp > k) continue;\n            if (nums[i] == k) {\n                ans += (long long)(l - i + 1);\n                continue;\n            }\n            int rightbound = l;\n            l = i; r = n;\n            while (l + 1 < r) {\n                int m = (l + r) / 2;\n                if (T.query(i, m + 1) > k) l = m;\n                else r = m;\n            }\n            tmp = T.query(i, r + 1);\n            assert(tmp == k);\n            ans += (long long)(rightbound - r + 1);\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1720278311",
    "subm_id": "1311703643"
}