{
    "username": "panda_269",
    "submission": "class Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        int n = nums.size(),sq = sqrt(n), lastIndex = (n-1)/sq+1;\n        vector<int> isKAndable(n);\n\n        for(int i=0;i<n;i++) {\n            if((nums[i]&k)==k) {\n                isKAndable[i]=1;\n            } else {\n                isKAndable[i]=0;\n            }\n        }\n        isKAndable[n-1] = isKAndable[n-1]==1?n-1:-1;\n        for(int i=n-2;i>=0;i--) {\n            if(isKAndable[i]==0) {\n                isKAndable[i] = -1;\n                continue;\n            }\n            if(isKAndable[i+1] == -1) {\n                isKAndable[i] = i;\n            } else {\n                isKAndable[i] = isKAndable[i+1];\n            }\n        }\n\n        vector<int> decom(lastIndex, -1);\n\n        for(int i=0;i<n;i++) {\n            int ind = i/sq;\n            if(decom[ind]==-1) {\n                decom[ind] = nums[i];\n            } else {\n                decom[ind] = decom[ind]&nums[i];\n            }\n        }\n        long long int ans = 0;\n        for(int i=0;i<n;i++) {\n            int startIndex=-1, endIndex=-1;\n\n            int ind = i/sq;\n            int curr = nums[i];\n            for(int j=i;(j<n) && (j<((ind+1)*sq));j++) {\n                curr = curr&nums[j];\n                if(curr == k) {\n                    if(startIndex == -1) {\n                        startIndex = j;\n                        break;\n                    }\n                }\n                if(curr<k) {\n                    break;\n                }\n            }\n\n            if(startIndex != -1) {\n                endIndex = isKAndable[startIndex];\n                ans+=(endIndex-startIndex+1);\n            // cout<<i<<\" a \"<<ans<<' '<<startIndex<<' '<<endIndex<<' '<<curr<<endl;\n                continue;\n            }\n\n\n            if(curr<k) {\n                continue;\n            }\n\n            ind++;\n            for(;ind<lastIndex;ind++) {\n                if((curr&decom[ind])<=k) {\n                    break;\n                }\n                curr = curr&decom[ind];\n            }\n\n            for(int j=ind*sq;j<n&&j<((ind+1)*sq);j++) {\n                if((curr&nums[j])==k) {\n                    startIndex = j;\n                    break;\n                }\n                curr = curr&nums[j];\n            }\n\n\n            if(curr<k) {\n                continue;\n            }\n            if(startIndex != -1) {\n                endIndex = isKAndable[startIndex];\n                ans+=(endIndex-startIndex+1);\n\n            // cout<<i<<\" b \"<<ans<<' '<<startIndex<<' '<<endIndex<<' '<<curr<<endl;\n                continue;\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1720280858",
    "subm_id": "1311804577"
}