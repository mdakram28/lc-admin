{
    "username": "Rad0miR",
    "submission": "public class Solution {\n    public long CountSubarrays(int[] nums, int k) \n    {\n        int b = 30;\n        int[][] cnt = new int[b][];\n        for (int i = 0; i < b; ++i) \n        {\n            cnt[i] = new int[nums.Length + 1];\n            for (int j = 1; j <= nums.Length; ++j) cnt[i][j] = cnt[i][j - 1] + (((~nums[j - 1]) >> i) & 1);\n            //if (i < 4) Console.WriteLine(String.Join(' ', cnt[i]));\n        }\n        \n        \n        \n        long ans = 0;\n        for (int i = 0; i < nums.Length; ++i) \n        {\n            int start = BS(i, k), end = BS(i, k - 1);\n            \n            //Console.WriteLine($\"{start} {end}\");\n            \n            ans += end - start;\n            \n            int BS(int f, int X) \n            {\n                int l = f - 1, r = nums.Length;\n                while (l + 1 < r) \n                {\n                    int m = (l + r) / 2;\n                    \n                    if (OK(m)) r = m; else l = m;\n                    \n                    bool OK(int ind) \n                    {\n                        int res = 0;\n                        for (int bit = 0; bit < b; ++bit) \n                        {\n                            int kol = cnt[bit][ind + 1] - cnt[bit][f];\n                            if (kol == 0) res |= 1 << bit;\n                        }\n                        return res <= X;\n                    }\n                }\n                return r;\n            }\n        }\n        \n        //Console.WriteLine();\n        return ans;\n    }\n}",
    "submit_ts": "1720278301",
    "subm_id": "1311703231"
}