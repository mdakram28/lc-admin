{
    "username": "Robert Costin",
    "submission": "typedef pair<int, int> pii;\ntypedef long long ll;\n#define f first\n#define s second\nclass Solution {\npublic:\n    int n;\n    ll bit1[100010], bit2[100010];\n    ll sum(ll arr[], int idx)\n    {\n        if(idx == -1) return 0;\n        ll ans = 0;\n        idx ++;\n        while(idx > 0)\n        {\n            ans += arr[idx];\n            idx -= idx & (-idx);\n        }\n        return ans;\n    }\n    void up(ll arr[], int idx, ll val)\n    {\n        idx ++;\n        while(idx <= n)\n        {\n            arr[idx] += val;\n            idx += idx & (-idx);\n        }\n    }\n    ll cnt[2][100010], mx[100010], pre[100010];\n    vector<pii> qs[100010];\n    vector<int> id[100010];\n    vector<long long> countKConstraintSubstrings(string s, int k, vector<vector<int>>& queries)\n    {\n        for(int i = 0; i < queries.size(); i ++)\n            qs[queries[i][1]].push_back({queries[i][0], i});\n        vector<ll> ans;\n        n = s.length();\n        ans.resize(queries.size());\n        cnt[0][0] = cnt[1][0] = 0;\n        for(int i = 0; i < n; i ++)\n        {\n            cnt[0][i+1] = cnt[0][i] + ((s[i]=='0')?1:0);\n            cnt[1][i+1] = cnt[1][i] + ((s[i]=='1')?1:0);\n        }\n        int z = 0, o = 0;\n        pre[0] = 0;\n        for(int i = 0; i < n; i ++)\n        {\n            int i1 = lower_bound(cnt[0], cnt[0]+n+1, k+1+z)-cnt[0]-1, i2 = lower_bound(cnt[1], cnt[1]+n+1, k+1+o)-cnt[1]-1;\n            mx[i] = max(i1, i2)-1;\n            id[mx[i]].push_back(i);\n            pre[i+1] = pre[i]+mx[i];\n            if(s[i] == '0') z++;\n            else o++;\n        }\n        for(int i = n-1; i >= 0; i --)\n        {\n            for(auto it : qs[i])\n            {\n                ll l = it.f, r = i;\n                ll an = pre[r+1]-pre[l];\n                an -= sum(bit1, r)-sum(bit1, l-1);\n                an += (ll)(sum(bit2, r)-sum(bit2, l-1))*(ll)r;\n                an -= (r*(r+1)/2)-((l-1)*l/2);\n                an += (r-l+1);\n                ans[it.s] = an;\n            }\n            for(auto it : id[i])\n            {\n                up(bit1, it, i);\n                up(bit2, it, 1);\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1723953034",
    "subm_id": "1359810663"
}