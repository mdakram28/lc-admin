{
    "username": "xz-lu",
    "submission": "#include<bits/stdc++.h>\n#define eb emplace_back\n#define ep emplace\nusing namespace std;\n\nusing ll = long long;\nconstexpr int N = 1e5 + 5;\n\n#define ls x << 1\n#define rs ls | 1\n\nclass Solution {\npublic:\n\tint n, t[N << 2], arr[N];\n\tvoid pushup(int x) {\n\t\tt[x] = t[ls] + t[rs];\n\t}\n\tvoid build(int x, int l, int r) {\n\t\tif(l == r) {\n\t\t\tt[x] = 0;\n\t\t\treturn;\n\t\t}\n\t\tint mid = l + r >> 1;\n\t\tbuild(ls, l, mid);\n\t\tbuild(rs, mid + 1, r);\n\t\t\n\t\tif(r - l <= 5) {\n\t\t\tfor(int i = l + 1; i <= r - 1; ++ i) {\n\t\t\t\tif(arr[i] > arr[i - 1] && arr[i] > arr[i + 1]) {\n\t\t\t\t\t++ t[x];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tpushup(x);\n\t\t\tif(l < mid) {\n\t\t\t\tif(arr[mid] > arr[mid - 1] && arr[mid] > arr[mid + 1]) {\n\t\t\t\t\t++ t[x];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(r > mid + 1) {\n\t\t\t\tif(arr[mid + 1] > arr[mid] && arr[mid + 1] > arr[mid + 2]) {\n\t\t\t\t\t++ t[x];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tint query(int L, int R, int x, int l, int r) {\n\t\tif(L <= l && r <= R) return t[x];\n\t\tint mid = l + r >> 1;\n\t\tint ret = 0;\n\t\tif(mid >= L) ret += query(L, R, ls, l, mid);\n\t\tif(mid < R) ret += query(L, R, rs, mid + 1, r);\n\t\t\n\t\tif(l < mid) {\n\t\t\tif(arr[mid] > arr[mid - 1] && arr[mid] > arr[mid + 1]) {\n\t\t\t\tif(L <= mid - 1 && R >= mid + 1)\n\t\t\t\t\t++ ret;\n\t\t\t}\n\t\t}\n\t\tif(r > mid + 1) {\n\t\t\tif(arr[mid + 1] > arr[mid] && arr[mid + 1] > arr[mid + 2]) {\n\t\t\t\tif(L <= mid && R >= mid + 2)\n\t\t\t\t\t++ ret;\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\t\n\tvoid modify(int p, int v, int x, int l, int r) {\n\t\tt[x] = 0;\n\t\tif(l == r) {\n\t\t\tarr[l] = v;\n\t\t\treturn; \n\t\t}\n\t\tint mid = l + r >> 1;\n\t\tif(p <= mid) modify(p, v, ls, l, mid);\n\t\telse modify(p, v, rs, mid + 1, r);\n\t\tif(r - l <= 5) {\n\t\t\tt[x] = 0;\n\t\t\tfor(int i = l + 1; i <= r - 1; ++ i) {\n\t\t\t\tif(arr[i] > arr[i - 1] && arr[i] > arr[i + 1]) {\n\t\t\t\t\t++ t[x];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tpushup(x);\n\t\t\tif(l != mid) {\n\t\t\t\tif(arr[mid] > arr[mid - 1] && arr[mid] > arr[mid + 1]) {\n\t\t\t\t\t++ t[x];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(r != mid + 1) {\n\t\t\t\tif(arr[mid + 1] > arr[mid] && arr[mid + 1] > arr[mid + 2]) {\n\t\t\t\t\t++ t[x];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tvector<int> countOfPeaks(vector<int>& a, vector<vector<int>>& qry) {\n\t\tvector<int> res;\n\t\tn = a.size();\n\t\tfor(int i = 0; i < n; ++ i) {\n\t\t\tarr[i] = a[i];\n\t\t}\n\t\tbuild(1, 0, n - 1);\n\t\t\n\t\tfor(auto &q : qry) {\n\t\t\tint op = q[0];\n\t\t\tif(op == 1) {\n\t\t\t\tres.eb(query(q[1], q[2], 1, 0, n - 1));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmodify(q[1], q[2], 1, 0, n - 1);\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n};\n",
    "submit_ts": 1718507686.0
}