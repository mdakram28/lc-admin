{
    "username": "meyi",
    "submission": "#pragma GCC optimize(\"Ofast,no-stack-protector,unroll-loops\")\n#define ALL(v) v.begin(),v.end()\n#define For(i,_) for(int i=0,i##end=_;i<i##end;++i) // [0,_)\n#define FOR(i,_,__) for(int i=_,i##end=__;i<i##end;++i) // [_,__)\n#define Rep(i,_) for(int i=(_)-1;i>=0;--i) // [0,_)\n#define REP(i,_,__) for(int i=(__)-1,i##end=_;i>=i##end;--i) // [_,__)\ntypedef long long ll;\ntypedef unsigned long long ull;\n#define V vector\n#define pb push_back\n#define pf push_front\n#define qb pop_back\n#define qf pop_front\n#define eb emplace_back\ntypedef pair<int,int> pii;\ntypedef pair<ll,int> pli;\n#define fi first\n#define se second\nconst int dir[4][2]={{-1,0},{0,1},{1,0},{0,-1}},inf=0x3f3f3f3f,mod=1e9+7;\nconst ll infl=0x3f3f3f3f3f3f3f3fll;\ntemplate<class T>inline bool ckmin(T &x,const T &y){return x>y?x=y,1:0;}\ntemplate<class T>inline bool ckmax(T &x,const T &y){return x<y?x=y,1:0;}\nint init=[](){return cin.tie(nullptr)->sync_with_stdio(false),0;}();\ntemplate<class T>\nstruct BIT{\n    // d-indexed [-d+1,n]->[1,n+d]\n    V<T>c1,c2;\n    int d,n;\n    inline void resize(int n_,int d_=1){\n        d=d_,n=n_;\n        V<T>(n+d+1).swap(c1);\n        V<T>(n+d+1).swap(c2);\n    }\n    inline BIT(int n=0,int d=1){resize(n,d);}\n    inline void add(int l,int r,const T &v){\n        if(l>r)return;\n        l+=d,assert(0<l),assert(l<=n+d);\n        for(int i=l;i<=n+d;i+=i&-i)c1[i]+=v,c2[i]+=(l-1)*v;\n        r+=d,assert(0<r),assert(r<=n+d);\n        for(int i=r+1;i<=n+d;i+=i&-i)c1[i]-=v,c2[i]-=r*v;\n    }\n    inline void add(int k,const T &v){add(k,k,v);} \n    inline T query(int l,int r){\n        if(l>r)return T();\n        T ret=0;\n        r+=d,assert(0<r),assert(r<=n+d);\n        for(int i=r;i;i^=i&-i)ret+=r*c1[i]-c2[i];\n        l+=d,assert(0<l),assert(l<=n+d);\n        for(int i=l-1;i;i^=i&-i)ret-=(l-1)*c1[i]-c2[i];\n        return ret;\n    }\n    inline T query(int k){return query(k,k);}\n};\nclass Solution {\npublic:\n    vector<int> numberOfAlternatingGroups(vector<int>& a, vector<vector<int>>& q) {\n        int n=a.size();\n        a.insert(a.end(),ALL(a)),a.qb();\n        set<pii>s;\n        BIT<ll>t(n);\n        auto calc=[&](int i,int j,int k){\n            if(i<n){\n                int mn=max(j-n+1,0);\n                if(j-i+1>n){\n                    int cnt=(j-n)-i+1;\n                    t.add(n,n,k*cnt);\n                    t.add(mn+1,n,k);\n                }\n                else t.add(mn+1,j-i+1,k);\n            }\n        };\n        auto ins=[&](int i,int j){\n            s.emplace(j,i);\n            calc(i,j,1);\n        };\n        For(i,a.size()){\n            int j=i+1;\n            while(j<a.size()&&a[j]!=a[j-1])++j;\n            ins(i,j-1);\n            i=j-1;\n        }\n        auto mdf=[&](int x,int y){\n            auto it=s.upper_bound({x,-1});\n            auto [r,l]=*it;\n            s.erase(it);\n            calc(l,r,-1);\n            if(l<x)ins(l,x-1);\n            if(x<r)ins(x+1,r);\n            a[x]=y;\n            int L=x,R=x;\n            if(x&&(a[x]!=a[x-1])){\n                auto it=prev(s.upper_bound({x,-1}));\n                auto [r,l]=*it;\n                s.erase(it);\n                calc(l,r,-1);\n                L=l;\n            }\n            if(x+1<a.size()&&a[x]!=a[x+1]){\n                auto it=s.upper_bound({x,-1});\n                auto [r,l]=*it;\n                s.erase(it);\n                calc(l,r,-1);\n                R=r;\n            }\n            ins(L,R);\n        };\n        V<int>ret;\n        for(auto &i:q){\n            if(i[0]&1)ret.pb(t.query(i[1],n));\n            else{\n                mdf(i[1],i[2]);\n                if(i[1]+1<n)mdf(i[1]+n,i[2]);\n            }\n        }\n        return ret;\n    }\n};",
    "submit_ts": "1722742628",
    "subm_id": "552345865"
}