{
    "username": "fmota",
    "submission": "using ll = long long;\n\nclass Solution {\npublic:\n    long long maximumScore(vector<vector<int>>& a) {\n        int n = a.size(), m = a[0].size();\n        vector<vector<ll>> b(n, vector<ll>(m, 0));\n        for(int i = 0; i < n; i++){\n            for(int j = 0; j < m; j++){\n                b[i][j] = a[i][j];\n                if(i) b[i][j] += b[i - 1][j];\n            }\n        }\n        vector<vector<ll>> dp(n + 1, vector<ll>(n + 1, -(1ll<<60)));\n        dp[0][0] = 0;\n        for(int j = 0; j < m; j++){\n            vector<vector<ll>> ndp(n + 1, vector<ll>(n + 1, -(1ll<<60)));\n            vector<vector<ll>> hu(n + 1, vector<ll>(n + 1, -(1ll<<60)));\n            vector<vector<ll>> hd(n + 1, vector<ll>(n + 1, -(1ll<<60)));\n            vector<ll> best(n + 1, -(1ll<<60));\n            for(int pi = 0; pi <= n; pi++){\n                for(int qi = 0; qi <= n; qi++){\n                    if(max(pi, qi) + 1 <= n){\n                        hu[qi][max(pi, qi) + 1] = max(\n                            hu[qi][max(pi, qi) + 1], \n                            dp[pi][qi] + (max(pi, qi) && j ? -b[max(pi, qi) - 1][j - 1] : 0)\n                        );\n                    }\n                    if(qi){\n                        hd[qi][qi - 1] = max(hd[qi][qi - 1], dp[pi][qi] + b[qi - 1][j]);\n                    }\n                    best[qi] = max(best[qi], dp[pi][qi]);\n                }\n            }\n            for(int qi = 0; qi <= n; qi++){\n                for(int i = 0; i <= n; i++){\n                    if(i){\n                        hu[qi][i] = max(hu[qi][i], hu[qi][i - 1]);\n                    }\n                    ndp[qi][i] = max(ndp[qi][i], hu[qi][i] + (j && i ? b[i - 1][j - 1] : 0));\n                }\n                for(int i = n; i >= 0; i--){\n                    if(i + 1 <= n){\n                        hd[qi][i] = max(hd[qi][i], hd[qi][i + 1]);\n                    }\n                    ndp[qi][i] = max(ndp[qi][i], hd[qi][i] - (i ? b[i - 1][j] : 0));\n                }\n                for(int i = 0; i <= n; i++){\n                    ndp[qi][i] = max(ndp[qi][i], best[qi]);\n                }\n            }\n            dp = ndp;\n        }\n        ll ans = 0;\n        for(int i = 0; i <= n; i++){\n            for(int j = 0; j <= n; j++){\n                ans = max(ans, dp[i][j]);\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1721488840",
    "subm_id": "1327434867"
}