{
    "username": "FyORVKn6Zf",
    "submission": "#include <bits/stdc++.h> \nusing namespace std;\n\nclass Solution {\npublic:\n    #define ll long long\n\n    const ll MN = -1e15;\n\n    int n, m;\n    vector<ll> mx;\n    vector<vector<ll>> a;\n    vector<vector<ll>> its; \n    vector<vector<vector<ll>>> f, b;\n\n    ll getMax(vector<ll>& a, int k, int l, int r, int u, int v) {\n        if (v < u) return MN;\n        if (l > v || r < u) return MN;\n        if (l >= u && r <= v) return a[k];\n\n        int mid = (l + r) / 2;\n        return max(getMax(a, k * 2, l, mid, u, v), getMax(a, k * 2 + 1, mid + 1, r, u, v));\n    }\n\n    void update(vector<ll>& a, int k, int l, int r, int x, ll val) {\n        if (l == r) {\n            a[k] = val;\n            return;\n        }\n\n        int mid = (l + r) / 2;\n        if (x <= mid) update(a, k * 2, l, mid, x, val);\n        else update(a, k * 2 + 1, mid + 1, r, x, val);\n\n        a[k] = max(a[k * 2], a[k * 2 + 1]);\n    }\n    \n    long long maximumValueSum(vector<vector<int>>& board) {\n        n = board.size(); m = board[0].size();\n        a = vector<vector<ll>>(n + 2, vector<ll>(m + 2, MN));\n        for (int i = 0; i < n; i++) {\n            for (int j = 0; j < m; j++) {\n                a[i + 1][j + 1] = board[i][j];\n            }\n        }\n\n        its = vector<vector<ll>>(n + 2, vector<ll>(m * 4, MN));\n        f = b = vector<vector<vector<ll>>>(n + 2, vector<vector<ll>>(m + 2, vector<ll>(m + 2, MN)));\n\n        for (int i = n; i >= 1; i--) {\n            for (int j = 1; j <= m; j++) {\n                update(its[i], 1, 1, m, j, a[i][j]);\n            }\n            for (int j = 1; j <= m; j++) {\n                for (int k = j + 1; k <= m; k++) {\n                    ll tmp1 = getMax(its[i], 1, 1, m, 1, j - 1);\n                    ll tmp2 = getMax(its[i], 1, 1, m, k + 1, m);\n                    ll tmp3 = getMax(its[i], 1, 1, m, j + 1, k - 1);\n                     \n                    b[i][j][k] = max(b[i + 1][j][k], max({tmp1, tmp2, tmp3}));\n                }\n            }\n        }\n\n        mx = vector<ll>(m + 2, MN);\n    \n        ll ans = MN;\n        for (int i = 1; i <= n - 1; i++) {\n            if (i > 1)\n                for (int j = 1; j <= m; j++) {\n                    for (int k = 1; k <= m; k++) {\n                        if (k == j) continue;\n\n                        ll res = j > k ? b[i + 1][k][j] : b[i + 1][j][k];\n                        ans = max(ans, a[i][j] + mx[k] + res);\n                    }\n                }\n\n            for (int j = 1; j <= m; j++) {\n                mx[j] = max(mx[j], a[i][j]); \n            }\n        }\n\n        return ans;\n    }\n};",
    "submit_ts": "1723909285",
    "subm_id": "1359186743"
}