{
    "username": "samliu12",
    "submission": "#include <bits/stdc++.h>\n#ifdef DEBUG\n#include \"debug.h\"\n#else\n#define dbg(x...)\n#endif\nusing namespace std;\nusing ll = long long;\n\nconst int N = 505, LG = 10;\n\nint st[N][N][LG][LG];\nint lg2[N];\n\nint yo(int x1, int y1, int x2, int y2) {\n  if (x1 > x2 || y1 > y2) return -2e9;\n  x2++;\n  y2++;\n  int a = lg2[x2 - x1], b = lg2[y2 - y1];\n  return max(\n         max(st[x1][y1][a][b], st[x2 - (1 << a)][y1][a][b]),\n         max(st[x1][y2 - (1 << b)][a][b], st[x2 - (1 << a)][y2 - (1 << b)][a][b])\n       );\n}\n\nvoid build(int n, int m, vector<vector<int>> &a) { // 0 indexed\n  for (int i = 2; i < N; i++) lg2[i] = lg2[i >> 1] + 1;\n  for (int i = 0; i < n; i++) {\n    for (int j = 0; j < m; j++) {\n      st[i][j][0][0] = a[i][j];\n    }\n  }\n  for (int a = 0; a < LG; a++) {\n    for (int b = 0; b < LG; b++) {\n      if (a + b == 0) continue;\n      for (int i = 0; i + (1 << a) <= n; i++) {\n        for (int j = 0; j + (1 << b) <= m; j++) {\n          if (!a) {\n            st[i][j][a][b] = max(st[i][j][a][b - 1], st[i][j + (1 << (b - 1))][a][b - 1]);\n          } else {\n            st[i][j][a][b] = max(st[i][j][a - 1][b], st[i + (1 << (a - 1))][j][a - 1][b]);\n          }\n        }\n      }\n    }\n  }\n}\n\nclass Solution {\npublic:\n    ll maximumValueSum(vector<vector<int>>& a) {\n\t\tint n = a.size(), m = a[0].size();\n\t\tbuild(n, m, a);\n\t\tcout << yo(0, 0, 1, 1) << endl;\n\n\t\tvector<vector<pair<int, int>>> dp(n, vector<pair<int, int>>(3));\n\t\tvector<vector<int>> idx(n, vector<int>(3, -1));\n\t\tfor (int i = 0; i < n; ++i) {\n\t\t\tvector<pair<int, int>> b;\n\t\t\tfor (int j = 0; j < m; ++j) {\n\t\t\t\tb.push_back({a[i][j], j});\n\t\t\t}\n\t\t\tsort(b.begin(), b.end(), greater<pair<int, int>>());\n\t\t\tfor (int j = 0; j < 3; ++j) dp[i][j] = b[j];\n\t\t}\n\t\tll ans = -3e9;\n\t\tfor (int i = 0; i < n; ++i) {\n\t\t\tfor (int j = i + 1; j < n; ++j) {\n\t\t\t\tfor (int x = 0; x < 3; ++x) {\n\t\t\t\t\tfor (int y = 0; y < 3; ++y) {\n\t\t\t\t\t\tif (dp[i][x].second != dp[j][y].second) {\n\t\t\t\t\t\t\t// blocked out rows are i, j\n\t\t\t\t\t\t\tint r1 = i, r2 = j;\n\t\t\t\t\t\t\tint c1 = dp[i][x].second, c2 = dp[j][y].second;\n\t\t\t\t\t\t\tif (c1 > c2) swap(c1, c2);\n\t\t\t\t\t\t\tvector<int> ops = {\n\t\t\t\t\t\t\t\tyo(0, 0, r1 - 1, c1 - 1),\n\t\t\t\t\t\t\t\tyo(0, c1 + 1, r1 - 1, c2 - 1),\n\t\t\t\t\t\t\t\tyo(0, c2 + 1, r1 - 1, m - 1),\n\t\t\t\t\t\t\t\tyo(r1 + 1, 0, r2 - 1, c1 - 1),\n\t\t\t\t\t\t\t\tyo(r1 + 1, c1 + 1, r2 - 1, c2 - 1),\n\t\t\t\t\t\t\t\tyo(r1 + 1, c2 + 1, r2 - 1, m - 1),\n\t\t\t\t\t\t\t\tyo(r2 + 1, 0, n - 1, c1 - 1),\n\t\t\t\t\t\t\t\tyo(r2 + 1, c1 + 1, n - 1, c2 - 1),\n\t\t\t\t\t\t\t\tyo(r2 + 1, c2 + 1, n - 1, m - 1),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tans = max<ll>(ans, (ll)dp[i][x].first + dp[j][y].first + *max_element(ops.begin(), ops.end()));\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ans;\n    }\n};",
    "submit_ts": "1723908179",
    "subm_id": "1359141567"
}