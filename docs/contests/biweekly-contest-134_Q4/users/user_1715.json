{
    "username": "anon_11",
    "submission": "class Solution {\n    vector<vector<int>> pref;\n    int lst(vector<int>& a, int& idx, int& k) {\n        int n = a.size();\n        int lo = idx, hi = n - 1, var = n - 1;\n        while(lo <= hi) {\n            int mid = lo + ((hi - lo) >> 1);\n            int val = 0;\n            for(int i = 0; i <= 30; i++) {\n                int cnt = pref[i][mid + 1] - pref[i][idx];\n                if(cnt != mid - idx + 1) continue;\n                val += (1 << i);\n            }\n            if(val >= k) {\n                lo = mid + 1;\n                var = mid;\n            } else {\n                hi = mid - 1;\n            }\n        }\n        int num = 0;\n        for(int i = 0; i <= 30; i++) {\n            int cnt = pref[i][var + 1] - pref[i][idx];\n            if(cnt == var - idx + 1) num += (1 << i);\n        }\n        if(num == k) {\n            return var;\n        } \n        return -1;\n    }\n    int frst(vector<int>& a, int& idx, int& k) {\n        int n = a.size();\n        int lo = idx, hi = n - 1, var = idx;\n        while(lo <= hi) {\n            int mid = lo + ((hi - lo) >> 1);\n            int val = 0;\n            for(int i = 0; i <= 30; i++) {\n                int cnt = pref[i][mid + 1] - pref[i][idx];\n                if(cnt == mid - idx + 1) {\n                    val += (1 << i);\n                }\n            }\n            if(val > k) {\n                lo = mid + 1;\n            } else {\n                var = mid;\n                hi = mid - 1;\n            }\n        }\n        int num = 0;\n        for(int i = 0; i <= 30; i++) {\n            int cnt = pref[i][var + 1] - pref[i][idx];\n            if(cnt == var - idx + 1) {\n                num += (1 << i);\n            }\n        }\n        if(num == k) {\n            return var;\n        } \n        return -1;\n    }\npublic:\n    using ll = long long;\n    ll countSubarrays(vector<int>& a, int k) {\n        int n = a.size();\n        pref.resize(31, vector<int>(n + 1, 0));\n        for(int i = 30; i >= 0; i--) {\n            for(int j = 0; j < n; j++) {\n                pref[i][j + 1] = pref[i][j] + ((a[j]>>i)&1);\n            }\n        }\n        ll ans = 0;\n        for(int i = 0; i < n; i++) {\n            if(a[i] < k) continue;\n            int fr = frst(a, i, k), ls = lst(a, i, k);\n            if(fr==-1)\n                continue;\n            ans += ls - fr + 1;\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1720281033",
    "subm_id": "1311810793"
}