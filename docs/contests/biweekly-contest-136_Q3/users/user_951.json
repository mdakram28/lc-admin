{
    "username": "8symbols",
    "submission": "class Solution:\n    def minFlips(self, grid: List[List[int]]) -> int:\n        m, n = len(grid), len(grid[0])\n        middle_i, middle_j = m // 2, n // 2\n\n        flips = 0\n\n        for i in range(middle_i):\n            for j in range(middle_j):\n                count = grid[i][j] + grid[m - 1 - i][j] + grid[m - 1 - i][n - 1 - j] + grid[i][n - 1 - j]\n                flips += min(count, 4 - count)\n\n        def dp_row(row, middle):\n            @cache\n            def dp(i, ones_rest):\n                if i == middle:\n                    return math.inf if ones_rest != 0 else 0\n                ones = row[i] + row[-1 - i]\n                flip_to_ones = 2 - ones + dp(i + 1, (ones_rest + 2) % 4)\n                flip_to_zeros = ones + dp(i + 1, ones_rest)\n                return min(flip_to_ones, flip_to_zeros)\n\n            return dp(0, 0)\n\n        @cache\n        def dp_cross(i, j, ones_rest):\n            if i == middle_i and j == middle_j:\n                return math.inf if ones_rest != 0 else 0\n\n            result = math.inf\n\n            if i != middle_i:\n                ones = grid[i][middle_j] + grid[-1 - i][middle_j]\n                flip_to_ones = 2 - ones + dp_cross(i + 1, j, (ones_rest + 2) % 4)\n                flip_to_zeros = ones + dp_cross(i + 1, j, ones_rest)\n                result = min(result, flip_to_ones, flip_to_zeros)\n\n            if j != middle_j:\n                ones = grid[middle_i][j] + grid[middle_i][-1 - j]\n                flip_to_ones = 2 - ones + dp_cross(i, j + 1, (ones_rest + 2) % 4)\n                flip_to_zeros = ones + dp_cross(i, j + 1, ones_rest)\n                result = min(result, flip_to_ones, flip_to_zeros)\n\n            return result\n\n        if m & 1 and n & 1:\n            flips += grid[middle_i][middle_j] + dp_cross(0, 0, 0)\n        elif m & 1:\n            flips += dp_row(grid[middle_i], middle_j)\n        elif n & 1:\n            flips += dp_row([grid[i][middle_j] for i in range(m)], middle_i)\n\n        return flips",
    "submit_ts": "1722698459",
    "subm_id": "1343181270"
}