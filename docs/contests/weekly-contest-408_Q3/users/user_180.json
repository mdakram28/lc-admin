{
    "username": "XKTZ",
    "submission": "typedef long long ll;\n\nll calcnum(ll c0, ll c1, ll len) {\n    return max(min(c1 + len - c0 * c0 + 1, len), 0ll);\n}\n\nll calcc0(ll c0, ll c1, ll len, ll n) {\n    ll cc = 0;\n    for (ll i = 1; i <= len && (i + c0) * (i + c0) <= n; i ++) {\n        if ((i + c0) * (i + c0) <= c1) cc ++;\n    }\n    return cc;\n}\n\nconstexpr ll MAXN = 1e5 + 5;\n\nll nxt0[MAXN], nxt1[MAXN];\n\nclass Solution {\npublic:\n    int numberOfSubstrings(string s) {\n        s.push_back('1');\n        ll n = s.size();\n        nxt0[n] = nxt1[n] = n;\n        for (ll i = n - 1; i >= 0; i--) {\n            nxt0[i] = nxt0[i + 1], nxt1[i] = nxt1[i + 1];\n            if (s[i] == '0') nxt0[i] = i;\n            if (s[i] == '1') nxt1[i] = i;\n        }\n        ll ans = 0;\n        for (ll i = 0; i < n; i ++) {\n            ll cc = 0;\n            for (ll now = nxt1[i], now0 = nxt0[now], c0 = nxt1[i] - i, c1 = 0; now < n; ) {\n                ll len1 = now0 - now;\n                ans += calcnum(c0, c1, len1);\n                c1 += len1;\n\n                ll len0 = nxt1[now0] - now0;\n                ans += calcc0(c0, c1, len0, n);\n                c0 += len0;\n\n                now = nxt1[now0];\n                now0 = nxt0[now];\n            }\n        }\n        ll c0 = 0, c1 = 0;\n        for (ll i = n - 1; i >= 0; i --) {\n            c0 += s[i] == '0', c1 += s[i] == '1';\n            if (c0 * c0 <= c1) ans --;\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1722135876",
    "subm_id": "1335716433"
}