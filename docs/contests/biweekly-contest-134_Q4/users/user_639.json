{
    "username": "jakao",
    "submission": "template<class T>\nstruct SparseTable{\n#define MAXN 200005\n#define K 18\n    int n;\n    T st[K + 1][MAXN];\n    T add(T lhs, T rhs){\n        return (lhs & rhs);\n    }\n    SparseTable(vector<T> &arr){\n        n = arr.size();\n        copy(arr.begin(), arr.end(), st[0]);\n        for (int i = 1; i <= K; i++)\n        for (int j = 0; j + (1 << i) <= n; j++)\n            st[i][j] = add(st[i - 1][j], st[i - 1][j + (1 << (i - 1))]);\n    }\n    T query(int L, int R){\n        T ret = st[0][L];\n        for (int i = K; i >= 0; i--) {\n            if ((1 << i) <= R - L + 1) {\n                ret = add(ret, st[i][L]);\n                L += 1 << i;\n            }\n        }\n        return ret;\n    }\n    pair<T, int> less_equal(int L, int v){//sum, index\n        T sum = st[0][L];\n        // cout << L << \" \" << v << \" : \";\n        ++L;\n        for (int i = K; i >= 0; i--) {\n            if ((1 << i) <= n - L && add(sum, st[i][L]) >= v) {\n                sum = add(sum, st[i][L]);\n                L += (1 << i);\n            }\n        }\n        // cout << sum << \" \" << L << endl;\n        return make_pair(sum, L-1);\n    }\n};\n\nclass Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        SparseTable<int> st(nums);\n        int n = nums.size();\n        long long ret = 0;\n        for(int i = 0; i < n; i++){\n            int l =  st.less_equal(i, k+1).second;\n            int r =  st.less_equal(i, k).second;\n            // cout << i << \" : \" << l << \"~\" << r << \" \" << st.query(i, l) << \" += \" << r-l << \"+\" << (st.less_equal(i, k+1).first==k) << endl;\n            if(st.query(i, r) != k)    continue;\n            else\n                ret += r - l + (st.less_equal(i, k+1).first==k);\n            // cout << i << \" : \" << l << \"~\" << r << \" \" << st.query(i, l) << \" += \" << r-l << \"+\" << (st.less_equal(i, k+1).first==k) << endl;\n        }\n        // cout << \" -------- \" << endl;\n        return ret;\n    }\n};",
    "submit_ts": "1720278891",
    "subm_id": "1311728639"
}