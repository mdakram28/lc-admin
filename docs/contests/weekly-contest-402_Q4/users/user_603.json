{
    "username": "twoplusthree",
    "submission": "const int INF=1e6+5;\nstruct S{\n  int cnt;\n  int lm[2],rm[2];\n};\nS op(S &a,S &b){\n  S res;\n  res.cnt=a.cnt+b.cnt;\n  if(a.rm[0]<a.rm[1]&&a.rm[1]>b.lm[0]){\n    res.cnt++;\n  }\n  if(a.rm[1]<b.lm[0]&&b.lm[0]>b.lm[1]){\n    res.cnt++;\n  }\n  res.lm[0]=a.lm[0];\n  if(a.lm[1]<INF){\n    res.lm[1]=a.lm[1];\n  }else{\n    res.lm[1]=b.lm[0];\n  }\n  res.rm[1]=b.rm[1];\n  if(b.rm[0]<INF){\n    res.rm[0]=b.rm[0];\n  }else{\n    res.rm[0]=a.rm[1];\n  }\n  return res;\n}\nS e(){\n  S res;\n  res.cnt=0;\n  res.lm[0]=res.lm[1]=res.rm[0]=res.rm[1]=INF;\n  return res;\n}\ntemplate<class S,S(*op)(S &a,S &b),S(*e)()> struct segtree{\nprivate:\n  int n;\n  vector<S> t;\n  void upd(int k){\n    t[k]=op(t[k<<1],t[k<<1|1]);\n  }\npublic:\n  segtree(int _n=0){\n    n=_n;\n    t=vector<S>(2*n,e());\n  }\n  segtree(vector<S> &arr){\n    n=(int)arr.size();\n    t=vector<S>(2*n);\n    for(int i=0;i<n;i++){\n      t[n+i]=arr[i];\n    }\n    for(int i=n-1;i>=1;i--){\n      upd(i);\n    }\n  }\n  void set(int p,S x){\n    for(t[p+=n]=x;p>>=1;){\n      upd(p);\n    }\n  }\n  S get(int p){\n    return t[n+p];\n  }\n  S prod(int l,int r){\n    if(l>=r){\n      return e();\n    }\n    S resl,resr;\n    resl=resr=e();\n    for(l+=n,r+=n;l<r;l>>=1,r>>=1){\n      if(l&1){\n        resl=op(resl,t[l++]);\n      }\n      if(r&1){\n        resr=op(t[--r],resr);\n      }\n    }\n    return op(resl,resr);\n  }\n  S all_prod(){\n    return t[1];\n  }\n};\nclass Solution{\npublic:\n  vector<int> countOfPeaks(vector<int> &nums,vector<vector<int>> &queries){\n    int n=(int)nums.size();\n    vector<S> lv(n);\n    for(int i=0;i<n;i++){\n      lv[i].cnt=0;\n      lv[i].lm[0]=lv[i].rm[1]=nums[i];\n      lv[i].lm[1]=lv[i].rm[0]=INF;\n    }\n    segtree<S,op,e> st(lv);\n    vector<int> ans;\n    for(auto &q:queries){\n      if(q[0]==1){\n        ans.push_back(st.prod(q[1],q[2]+1).cnt);\n      }else{\n        S newval;\n        newval.cnt=0;\n        newval.lm[0]=newval.rm[1]=q[2];\n        newval.lm[1]=newval.rm[0]=INF;\n        st.set(q[1],newval);\n      }\n    }\n    return ans;\n  }\n};",
    "submit_ts": "1718507716",
    "subm_id": "1289660286"
}