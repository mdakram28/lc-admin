{
    "username": "lifam",
    "submission": "class Solution {\n  public List<Integer> countOfPeaks(int[] nums, int[][] queries) {\n    int len = nums.length;\n    // build\n    int[] data = new int[len * 4 + 1], arr = new int[len];\n    for (int i = 0; i < len; i++) {\n      update(data, arr, 1, 0, len - 1, i, nums[i]);\n    }\n    // query\n    List<Integer> ans = new ArrayList<>();\n    for (int[] q : queries) {\n      if (q[0] == 1) {\n        int left = q[1], right = q[2];\n        ans.add(query(data, arr, 1, 0, len - 1, left, right));\n      } else if (q[0] == 2) {\n        update(data, arr, 1, 0, len - 1, q[1], q[2]);\n      }\n    }\n    return ans;\n  }\n\n  private void update(int[] data, int[] nums, int i, int l, int r, int x, int v) {\n    if (x < l || r < x) {\n      return;\n    }\n    if (l == r) {\n      data[i] = 0;\n      nums[x] = v;\n      return;\n    }\n    int mid = (l + r) / 2, i1 = i * 2, i2 = i1 + 1;\n    update(data, nums, i1, l, mid, x, v);\n    update(data, nums, i2, mid + 1, r, x, v);\n    int count = data[i1] + data[i2];\n    if (mid - 1 >= l && nums[mid] > nums[mid - 1] && nums[mid] > nums[mid + 1]) {\n      count++;\n    }\n    if (mid + 2 <= r && nums[mid + 1] > nums[mid + 2] && nums[mid + 1] > nums[mid]) {\n      count++;\n    }\n    data[i] = count;\n  }\n\n  private int query(int[] data, int[] nums, int i, int l, int r, int left, int right) {\n    if (right < l || r < left) {\n      return 0;\n    }\n    if (left <= l && r <= right) {\n      return data[i];\n    }\n    int mid = (l + r) / 2, i1 = i * 2, i2 = i1 + 1;\n    int count = query(data, nums, i1, l, mid, left, right);\n    count += query(data, nums, i2, mid + 1, r, left, right);\n    int maxL = Math.max(l, left), minR = Math.min(r, right);\n    if (maxL <= mid - 1 && mid + 1 <= minR) {\n      if (nums[mid] > nums[mid - 1] && nums[mid] > nums[mid + 1]) {\n        count++;\n      }\n    }\n    if (maxL <= mid && mid + 2 <= minR) {\n      if (nums[mid + 1] > nums[mid] && nums[mid + 1] > nums[mid + 2]) {\n        count++;\n      }\n    }\n    return count;\n  }\n}",
    "submit_ts": 1718508148.0
}