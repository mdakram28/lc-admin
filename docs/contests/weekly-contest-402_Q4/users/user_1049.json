{
    "username": "priceless-margulismpb",
    "submission": "class Solution {\n    public List<Integer> countOfPeaks(int[] nums, int[][] queries) {\n        int n = nums.length;\n        TreeArray ta = new TreeArray(n);\n        boolean[] isF = new boolean[n];\n        for (int i = 1; i < n - 1; i++) {\n            if (nums[i] > nums[i - 1] && nums[i] > nums[i + 1]) {\n                isF[i] = true;\n                ta.add(i + 1, 1);\n            }\n        }\n        List<Integer> res = new ArrayList<>();\n        for (int[] q : queries) {\n            int type = q[0];\n            if (type == 2) {\n                int i = q[1];\n                int val = q[2];\n                nums[i] = val;  //\u53d8\u503c\n                if (i == 0) {\n                    if (isF[1] && nums[0] >= nums[1]) {  //\u7834\u574f\u5cf0\u503c\n                        isF[1] = false;\n                        ta.add(2, -1);\n                    }\n                    if (!isF[1] && nums[0] < nums[1] && nums[2] < nums[1]) {\n                        isF[1] = true;\n                        ta.add(2, 1);\n                    }\n                }\n                else if (i == n - 1) {\n                    if (isF[n - 2] && nums[n - 1] >= nums[n - 2]) {  //\u7834\u574f\u5cf0\u503c\n                        isF[n - 2] = false;\n                        ta.add(n - 1, -1);\n                    }\n                    if (!isF[n - 2] && nums[n - 1] < nums[n - 2] && nums[n - 3] < nums[n - 2]) {\n                        isF[n - 2] = true;\n                        ta.add(n - 1, 1);\n                    }\n                }\n                else {\n                    if (isF[i - 1] && nums[i - 1] <= nums[i]) {\n                        isF[i - 1] = false;\n                        ta.add(i, -1);\n                    }\n                    else if (!isF[i - 1] && i - 2 >= 0 && nums[i - 1] > nums[i - 2] && nums[i - 1] > nums[i]) {\n                        isF[i - 1] = true;\n                        ta.add(i, 1);\n                    }\n                    if (isF[i + 1] && nums[i + 1] <= nums[i]) {\n                        isF[i + 1] = false;\n                        ta.add(i + 2, -1);\n                    }\n                    else if (!isF[i + 1] && i + 2 < n && nums[i + 1] > nums[i + 2] && nums[i + 1] > nums[i]) {\n                        isF[i + 1] = true;\n                        ta.add(i + 2, 1);\n                    }\n                    if (isF[i] && (nums[i] <= nums[i - 1] || nums[i] <= nums[i + 1])) {\n                        isF[i] = false;\n                        ta.add(i + 1, -1);\n                    }\n                    else if (!isF[i] && nums[i] > nums[i - 1] && nums[i] > nums[i + 1]) {\n                        isF[i] = true;\n                        ta.add(i + 1, 1);\n                    }\n                }\n            }\n            else {\n                int l = q[1];\n                int r = q[2];\n                int cnt = ta.query(r + 1) - ta.query(l);\n                if (isF[l]) {\n                    cnt--;\n                }\n                if (r != l && isF[r]) {\n                    cnt--;\n                }\n                res.add(cnt);\n            }\n        }\n        return res;\n    }\n}\n\nclass TreeArray {\n    private int[] tree;\n    private int[] A;\n    private int n;\n\n    public TreeArray(int n) {\n        this.n = n;\n        this.A =  new int[n + 1];\n        this.tree = new int[n + 1];  //\u6784\u5efa\u7ba1\u63a7\u6570\u7ec4\uff0c\u4e0b\u6807\u4ece 1 ~ n\n    }\n\n    public int lowbit(int m) {\n        return m & -m;\n    }\n\n    public int query(int x) {  //\u67e5\u8be2\u524dx\u4e2a\u5143\u7d20\u7684\u548c\n        int res = 0;\n        for (int i = x; i > 0; i -= lowbit(i)) {\n            res += tree[i];\n        }\n        return res;\n    }\n\n    public void add(int i, int u) {  //nums[i]\u82e5\u589e\u52a0u\uff0ctree\u6570\u7ec4\u4e2d\u6240\u6709\u7ba1\u63a7nums[i]\u7684\u503c\u4e5f\u8981\u76f8\u5e94\u589e\u52a0\n        for (int j = i; j <= n; j += lowbit(j)) {\n            tree[j] += u;\n        }\n    }\n}",
    "submit_ts": "1718508203",
    "subm_id": "539786004"
}