{
    "username": "Quynh",
    "submission": "#define ll long long\n\nclass Solution {\npublic:\n    vector<long long> countKConstraintSubstrings(string s, int k, vector<vector<int>>& queries) {\n        ll n = s.size();\n        vector<ll> next(n+1);\n        ll one = 0, zero = 0,left = 0, right = 0;\n        while(right<n){\n            if(s[right]=='1') one++;\n            else zero++;\n            right++;\n            while(one>k || zero>k){\n                next[left+1] = right-1;\n                if(s[left]=='1') one--;\n                else zero--;\n                left++;\n            }\n        }\n        while(left<right){\n            next[left+1] = right;\n            left++;\n        }\n        vector<ll> pre(n+1);\n        for(int i = 1; i<= n; i++)\n        pre[i]=pre[i-1]+next[i]-i+1;\n        // only 1\n        vector<ll> next2(n+1);\n        one = 0, zero = 0,left = 0, right = 0;\n        while(right < n){\n            if(s[right]=='1') one++;\n            else zero++;\n            right++;\n            while(one>k ){\n                next2[left+1] = right-1;\n                if(s[left]=='1') one--;\n                else zero--;\n                left++;\n            }\n        }\n        while(left<right){\n            next2[left+1] = right;\n            left++;\n        }\n        vector<ll> pre2(n+1);\n        for(int i = 1; i <= n; i++)\n            pre2[i]=pre2[i-1]+next2[i]-i+1;\n        // end only 1\n        // only 0\n        vector<ll> next3(n+1);\n        one = 0, zero = 0,left = 0, right = 0;\n        while(right < n){\n            if(s[right]=='1') one++;\n            else zero++;\n            right++;\n            while(zero>k ){\n                next3[left+1] = right-1;\n                if(s[left]=='1') one--;\n                else zero--;\n                left++;\n            }\n        }\n        while(left<right){\n            next3[left+1] = right;\n            left++;\n        }\n        vector<ll> pre3(n+1);\n        for(int i = 1; i <= n; i++)\n            pre3[i]=pre3[i-1]+next3[i]-i+1;\n        // end only 0\n        ll q = queries.size();\n        vector<ll> res;\n        for(int i = 0; i < q; i++){\n            ll l = queries[i][0] + 1, r = queries[i][1] + 1;\n            ll L = l, R = r;\n            ll index = lower_bound(next.begin(),next.end(),r)-next.begin();\n            ll index2 = lower_bound(next2.begin(),next2.end(),r)-next2.begin();\n            ll index3 = lower_bound(next3.begin(),next3.end(),r)-next3.begin();\n            ll ans = 0;\n            if(index<=r){\n                if(index<l) index = l;\n                ans = (r-index+1)*(r-index+2)/2;\n                r = index-1;\n            }\n            if(r>=l) ans+=pre[r]-pre[l-1];\n            //\n            r = R, l = L;\n            ll ans2 = 0;\n            if(index2<=r){\n                if(index2<l) index2 = l;\n                ans2 = (r-index2+1)*(r-index2+2)/2;\n                r = index2-1;\n            }\n            if(r>=l) ans2+=pre2[r]-pre2[l-1];\n            //\n            //\n            r = R, l = L;\n            ll ans3 = 0;\n            if(index3<=r){\n                if(index3<l) index3 = l;\n                ans3 = (r-index3+1)*(r-index3+2)/2;\n                r = index3-1;\n            }\n            if(r>=l) ans3+=pre3[r]-pre3[l-1];\n            //\n            res.push_back(ans2 + ans3 - ans);\n        }\n        return res;\n    }\n};\n\n// both 1 and 0 at most k = temp\n// #1 at most k or #0 at most k\n// every substring - temp - #1 more than k - #0 more than k - #1\n// 0001111\n// 3 + 4 + 3 + ",
    "submit_ts": "1723952052",
    "subm_id": "1359786707"
}