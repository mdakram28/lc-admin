{
    "username": "cchao",
    "submission": "using LL = long long;\nclass Solution {\npublic:\n    long long countSubarrays(vector<int>& a, int k) {\n        const int n = a.size();\n        // for (int &x : a) x &= k;\n        vector<array<uint32_t,20>> d(n);\n        for (int j = 0; j < 20; ++j) {\n            for (int i = 0; i < n; ++i) {\n                if (j == 0) {\n                    d[i][j] = a[i];\n                } else if (i + (1 << j) <= n) {\n                    d[i][j] = d[i][j-1] & d[i+(1<<(j-1))][j-1];\n                }\n                // cout << \"d \" << i << ' ' << j << ' ' << d[i][j] << endl;\n            }\n        }\n        auto S = [&](int i, int len) {\n            uint32_t r = a[i];\n            for (int j = 19; j >= 0 && len > 0; --j) {\n                int t = 1 << j;\n                if (len >= t) {\n                    r &= d[i][j];\n                    len -= t;\n                    i += t;\n                }\n            }\n            return r;\n        };\n        long long ans = 0;\n        for (int i = 0; i < n; ++i) {\n            if ((a[i] & k) < k) continue;\n            int l = 1, r = n - i, lb = -1;\n            while (l <= r) {\n                const int m = (l + r) >> 1;\n                int t = S(i, m);\n                if ((t & k) < k) r = m - 1;\n                else {\n                    if (t == k) {\n                        lb = i + m - 1;\n                        r = m - 1;\n                    } else {\n                        l = m + 1;\n                    }\n                }\n            }\n            if (lb == -1) continue;\n\n            l = 1, r = n - lb;\n            int rb = lb;\n            while (l <= r) {\n                const int m = (l + r) >> 1;\n                int t = S(lb, m);\n                if ((t & k) < k) r = m - 1;\n                else {\n                    rb = lb + m - 1;\n                    l = m + 1;\n                }\n            }\n            // cout << i << \": \" << lb << \" - \" << rb << endl;\n            ans += rb - lb + 1;\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1720278735",
    "subm_id": "1311722016"
}