{
    "username": "ppqq996",
    "submission": "/**\n * @param {number[]} nums\n * @param {number[][]} queries\n * @return {number[]}\n */\nvar countOfPeaks = function(nums, queries) {\n    const n = nums.length;\n    const t1 = [];\n    const t2 = [];\n\n    const lowbit = (x) => x & (-x);\n\n    const add = (k, v) => {\n        let v1 = k * v;\n        while (k <= n) {\n            t1[k] = (t1[k] || 0) + v;\n            t2[k] = (t2[k] || 0) + v1;\n            // \u6ce8\u610f\u4e0d\u80fd\u5199\u6210 t2[k] += k * v\uff0c\u56e0\u4e3a k \u7684\u503c\u5df2\u7ecf\u4e0d\u662f\u539f\u6570\u7ec4\u7684\u4e0b\u6807\u4e86\n            k += lowbit(k);\n        }\n    };\n\n    const getsum = (t, k) => {\n        let ret = 0;\n        while (k) {\n            ret += t[k] || 0;\n            k -= lowbit(k);\n        }\n        return ret;\n    };\n\n    const add1 = (l, r, v) => {\n        add(l, v);\n        add(r + 1, -v);  // \u5c06\u533a\u95f4\u52a0\u5dee\u5206\u4e3a\u4e24\u4e2a\u524d\u7f00\u52a0\n    }\n\n    const getsum1 = (l, r) => {\n        return (r + 1) * getsum(t1, r) - 1 * l * getsum(t1, l - 1) -\n            (getsum(t2, r) - getsum(t2, l - 1));\n    };\n\n    const rt = [];\n    const rc = new Array(n).fill(0);\n    for (let i = 0; i < nums.length; i++) {\n        if (nums[i] > nums[i - 1] && nums[i] > nums[i + 1]) {\n            add1(i, i, 1);\n            rc[i] = 1;\n        }\n    }\n    const change = (index, val) => {\n        if (index < 0 || index >= n) return;\n        const i_p = rc[index];\n        nums[index] = val;\n        if (val > nums[index - 1] && val > nums[index + 1]) {\n            rc[index] = 1;\n            if (i_p) return;\n            add1(index, index, 1);\n        } else {\n            rc[index] = 0;\n            if (i_p) {\n                add1(index, index, -1);\n            }\n        }\n    };\n    for (const q of queries) {\n        if (q[0] === 1) {\n            const left = q[1];\n            const right = q[2];\n            const t_1 = getsum1(left, right);\n            const t_2 = getsum1(left, left);\n            const t_3 = left === right ? 0 : getsum1(right, right);\n            rt.push(t_1 - t_2 - t_3);\n        } else {\n            const index = q[1];\n            const val = q[2];\n            change(index, val);\n            change(index + 1, nums[index + 1]);\n            change(index - 1, nums[index - 1]);\n        }\n    }\n    return rt;\n};",
    "submit_ts": "1718507881",
    "subm_id": "539784005"
}