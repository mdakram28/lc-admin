{
    "username": "audience-ne",
    "submission": "class Solution {\npublic:\n    struct node{\n        long long ma;\n        node*l,*r;\n    };\n    node*x;\n    void add(node*&x,long long L,long long R,long long l,long long r,long long val){\n        if(!x) x=new node();\n        if(l<=L&&R<=r){\n            x->ma=val;\n            return ;\n        }\n        long long mid=(L+R)>>1;\n        if(l<=mid) add(x->l,L,mid,l,r,val);\n        if(r>mid )add(x->r,mid+1,R,l,r,val);\n        x->ma=(x->l?x->l->ma:0)+(x->r?x->r->ma:0);\n    }\n    long long query(node*x,long long L,long long R,long long l,long long r){\n        if(!x||l>R||L>r) return 0;\n        if(l<=L&&R<=r) return x->ma;\n        long long mid=(L+R)>>1;\n        return query(x->l,L,mid,l,r)+query(x->r,mid+1,R,l,r);\n    }\n    vector<int> countOfPeaks(vector<int>& nums, vector<vector<int>>& queries) {\n        int L=0,R=nums.size()-1;\n        add(x,L,R,0,0,0);\n        add(x,L,R,R,R,0);\n        for(int i=1;i<nums.size()-1;i++){\n            int t=(nums[i]>nums[i-1]&&nums[i]>nums[i+1]);\n            add(x,L,R,i,i,t);\n        }\n        vector<int>ans;\n        for(auto&it:queries){\n            if(it[0]==1){\n                int l=it[1]+1,r=it[2]-1;\n                if(l<=r){\n                    ans.push_back(query(x,L,R,l,r));\n                }\n                else ans.push_back(0);\n            }\n            else{\n                int st=it[1],val=it[2];\n                nums[st]=val;\n                if(st-1>0){\n                    if(nums[st-1]>nums[st-2]&&nums[st-1]>nums[st]) add(x,L,R,st-1,st-1,1);\n                    else add(x,L,R,st-1,st-1,0);\n                }\n                if(st>0&&st<nums.size()-1){\n                    if(nums[st]>nums[st-1]&&nums[st]>nums[st+1]) add(x,L,R,st,st,1);\n                    else add(x,L,R,st,st,0);\n                }\n                if(st+1<nums.size()-1){\n                    if(nums[st+1]>nums[st]&&nums[st+1]>nums[st+2]) add(x,L,R,st+1,st+1,1);\n                    else add(x,L,R,st+1,st+1,0);\n                }\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": 1718507890.0
}