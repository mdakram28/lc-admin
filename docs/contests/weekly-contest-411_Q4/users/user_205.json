{
    "username": "\u9053\u67d2",
    "submission": "using i64 = long long;\n\nclass Solution {\npublic:\n    vector<long long> countKConstraintSubstrings(string s, int k, vector<vector<int>> &queries) {\n        int n = s.size();\n        s = \" \" + s;\n        std::vector<int> L(n + 1), R(n + 1), bl(n + 1);\n        int one = 0, zero = 0;\n        for (int l = 1, r = 1; r <= n; r++) {\n            if (s[r] == '1') one++;\n            else zero++;\n            while (one > k && zero > k) {\n                R[l] = r - 1;\n                if (s[l] == '1') one--;\n                else zero--;\n                l++;\n            }\n            L[r] = l;\n        }\n        int siz = std::sqrt(n);\n        for (int i = 1; i <= n; i++) {\n            if (!R[i]) R[i] = n;\n            bl[i] = (i - 1) / siz + 1;\n        }\n\n        std::vector<std::array<int, 3>> q;\n        for (int i = 0; i < queries.size(); i++) {\n            auto &Q = queries[i];\n            Q[0]++, Q[1]++;\n            q.push_back({Q[0], Q[1], i});\n        }\n        std::sort(q.begin(), q.end(), [&](auto &x, auto &y) {\n            return bl[x[0]] == bl[y[0]] ? bl[x[1]] > bl[y[1]] : bl[x[0]] < bl[y[0]];\n        });\n\n        int l = 1, r = 0;\n        i64 ans = 0;\n        auto add = [&](int id, int op) {\n            if (op == 1) {\n                ans += id - std::max(L[id], l) + 1;\n            } else {\n                ans += std::min(R[id], r) - id + 1;\n            }\n        };\n\n        auto sub = [&](int id, int op) {\n            if (op == 1) {\n                ans -= (id - std::max(L[id], l) + 1);\n            } else {\n                ans -= (std::min(R[id], r) - id + 1);\n            }\n        };\n        std::vector<i64> res(q.size());\n        for (auto [ql, qr, id]: q) {\n            while (r < qr) add(++r, 1);\n            while (l > ql) add(--l, 0);\n            while (r > qr) sub(r--, 1);\n            while (l < ql) sub(l++, 0);\n            res[id] = ans;\n        }\n        return res;\n    }\n};",
    "submit_ts": "1723950771",
    "subm_id": "556401149"
}