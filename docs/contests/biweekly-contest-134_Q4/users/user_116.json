{
    "username": "lost-temple-2",
    "submission": "public class Solution {\n    \n    private int[][] st;\n    private int[] log;\n    \n    public long CountSubarrays(int[] nums, int k) {\n        int n = nums.Length;\n        st = new int[n][];\n        for (int i=0;i<n;i++) {\n            st[i] = new int[20];\n            st[i][0] = nums[i];\n        }\n        log = new int[n+1];\n        for (int i=2;i<=n;i++) {\n            log[i] = log[i/2] + 1;\n        }\n        for (int j=1;j<20;j++) {\n            for (int i=0;i+(1<<j)-1<n;i++) {\n                st[i][j] = st[i][j-1] & st[i+(1<<j-1)][j-1];\n            }\n        }\n        long ans = 0;\n        int andVal = nums[0];\n        for (int i=0;i<n;i++) {\n            if (nums[i] < k) {\n                continue;\n            }\n            andVal &= nums[i];\n            if (andVal > k) {\n                continue;\n            }\n            int lp = -1,rp = -1;\n            int left = 0,right = i;\n            while (left <= right) {\n                int mid = left + (right-left) / 2;\n                int v = Query(mid,i);\n                if (v >= k) {\n                    lp = mid;\n                    right = mid - 1;\n                } else {\n                    left = mid + 1;\n                }\n            }\n            left = 0;\n            right = i;\n            while (left <= right) {\n                int mid = left + (right-left) / 2;\n                int v = Query(mid,i);\n                if (v <= k) {\n                    rp = mid;\n                    left = mid + 1;\n                } else {\n                    right = mid - 1;\n                }\n            }\n            if (lp == -1 || rp == -1 || lp > rp) {\n                continue;\n            }\n            ans += rp - lp + 1;\n        }\n        return ans;\n    }\n    \n    private int Query(int left,int right) {\n        int len = right - left + 1;\n        int lg = log[len];\n        return st[left][lg] & st[right-(1<<lg)+1][lg];\n    }\n}",
    "submit_ts": "1720278010",
    "subm_id": "544560163"
}