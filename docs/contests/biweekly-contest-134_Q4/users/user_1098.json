{
    "username": "inversionpeter",
    "submission": "int prefixSums[100001][32];\n\nclass Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        long long counts = 0;\n        int lower, upper, middle, length, AND, answer1, answer2;\n        for (int i = 0; i != nums.size(); ++i) {\n            for (int j = 0; j < 32; ++j) {\n                prefixSums[i + 1][j] = prefixSums[i][j] + ((nums[i] >> j) & 1);\n            }\n        }\n        for (int i = 0; i != nums.size(); ++i) {\n            lower = i;\n            upper = nums.size() - 1;\n            answer1 = answer2 = -1;\n            while (lower <= upper) {\n                AND = 0;\n                middle = (lower + upper) >> 1;\n                length = middle - i + 1;\n                for (int j = 0; j < 32; ++j) {\n                    if (prefixSums[middle + 1][j] - prefixSums[i][j] == length) {\n                        AND |= (1 << j);\n                    }\n                }\n                if (AND <= k) {\n                    answer1 = middle;\n                    upper = middle - 1;\n                }\n                else {\n                    lower = middle + 1;\n                }\n            }\n            lower = i;\n            upper = nums.size() - 1;\n            while (lower <= upper) {\n                AND = 0;\n                middle = (lower + upper) >> 1;\n                length = middle - i + 1;\n                for (int j = 0; j < 32; ++j) {\n                    if (prefixSums[middle + 1][j] - prefixSums[i][j] == length) {\n                        AND |= (1 << j);\n                    }\n                }\n                if (AND <= k - 1) {\n                    answer2 = middle;\n                    upper = middle - 1;\n                }\n                else {\n                    lower = middle + 1;\n                }\n            }\n            if (answer1 != -1) {\n                if (answer2 == -1) {\n                    counts += nums.size() - answer1;\n                    //cout << nums.size() - answer1 << ' ';\n                }\n                else {\n                    counts += answer2 - answer1;\n                    //cout << answer2 - answer1 << \"(\" << answer1 << ' ' << answer2 << \") \";\n                }\n            }\n        }\n        //cout << '\\n';\n        return counts;\n    }\n};",
    "submit_ts": "1720280156",
    "subm_id": "1311778899"
}