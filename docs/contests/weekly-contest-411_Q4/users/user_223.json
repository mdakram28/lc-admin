{
    "username": "regain0001",
    "submission": "class Solution {\n    #define ll long long\n#define _for(i,a,b) for(ll i=(a);i<=(b);++i)\n#define _for2(i,a,b) for(ll i=(a);i>=(b);--i)\n#define pb emplace_back\n#define fi first\n#define se second\n#define all(x) x.begin(),x.end()\n#define sz(x) (int)x.size()\n#define MAXN 100005\n#define cy std::cout<<\"Yes\\n\"\n#define cn std::cout<<\"No\\n\"\n#ifndef M_PI\n#define M_PI 3.14159265358979323846\n#endif // !M_PI\n#ifndef NOWMS\n#define NOWMS                                                   \\\n    std::chrono::duration_cast<std::chrono::milliseconds>(      \\\n        std::chrono::system_clock::now().time_since_epoch())\\\n        .count()\n#endif // !NOWMS\nusing pii = pair<int, int>;\nusing pll = pair<ll, ll>;\nusing plll = pair<pll, ll>;\nusing pllll = pair<pll, pll>;\nusing pl2 = pair<plll, plll>;\npublic:\n    vector<long long> countKConstraintSubstrings(string s, int k, vector<vector<int>>& q) {\n        ll n=sz(s);\n        //0001111\n        ll m=sz(q);\n        vector<ll>ans(m);\n        \n        //\u8ba1\u7b97vec\n        vector<int>v0(n);//\u8be5\u4f4d\u7f6e\u662f\u7b2c\u51e0\u4e2a0\n        vector<int>v1(n);//\u8be5\u4f4d\u7f6e\u662f\u7b2c\u51e0\u4e2a1\n        vector<int>p0(n+1,-1);//\u7b2ci\u4e2a0\u7684\u4e0b\u6807\n        vector<int>p1(n+1,-1);//\u7b2ci\u4e2a1\u7684\u4e0b\u6807\n        ll cnt0=0,cnt1=0;\n        _for(i,0,n-1){\n            if(s[i]=='0'){\n                cnt0++;\n                p0[cnt0]=i;\n            }else{\n                cnt1++;\n                p1[cnt1]=i;\n            }\n            v0[i]=cnt0;\n            v1[i]=cnt1;\n        }\n        vector<ll>vec(n);//\u6307\u5411\u975ek\u7ea6\u675f\u7684\u6700\u53f3\u4f4d\u7f6e\uff0c\u53ef\u80fd\u4e3a-1   s0>k&&s1>k\n        _for(i,0,n-1){\n           // cout<<\"i:\"<<i<<endl;\n            ll c0=v0[i];\n            ll c1=v1[i];\n            if(c0<=k||c1<=k){\n                vec[i]=-1;\n            }else{\n                ll due0=c0-k;\n                ll due1=c1-k;\n                ll pos0=p0[due0];\n                ll pos1=p1[due1];\n                //cout<<\"pos0:\"<<pos0<<endl;\n                //cout<<\"pos1:\"<<pos1<<endl;\n                ll minpos=min(pos0,pos1);\n                vec[i]=minpos;\n            }\n          //  cout<<\"vec[i]:\"<<vec[i]<<endl;\n        }\n       // cout<<\"?\\n\";\n       // cout<<vec[0]<<endl;\n        auto getl=[&](ll x)->ll{\n            return vec[x]+1;//\u4e00\u5b9a\u662f\u4e00\u4e2a\u5408\u6cd5\u4e0b\u6807\n        };\n        vector<ll>v2(n);//\u81ea\u5df1\u7684\u503c\n        vector<ll>pre1(n+1);\n        _for(i,1,n){\n            ll j=i-1;//0-n-1\n            //cout<<\"i:\"<<i<<endl;\n            v2[j]=(j-getl(j)+1);\n            //cout<<\"v2[j]:\"<<v2[j]<<endl;\n            pre1[i]=pre1[i-1]+v2[j];\n            //cout<<\"pre1:\"<<pre1[i]<<endl;\n        }\n        auto getsum1=[&](ll x,ll y)->ll{\n            //x,y   0~n-1\n            return pre1[y+1]-pre1[x];\n        };\n        //cout<<\"ok\\n\";\n        _for(i,0,m-1){\n           // cout<<\"i:\"<<i<<endl;\n            ll l=q[i][0],r=q[i][1];\n            ll len=r-l+1;\n            //cout<<\"l:\"<<l<<\"r:\"<<r<<endl;\n            //cal ans[i]\n            if(l==r){\n                ans[i]=1;\n            }else{\n                if(getl(l)==l){\n                    ans[i]=getsum1(l,r);\n                }else{\n                    //getl(l)<l\n                    if(getl(r)<l){\n                        ans[i]=(1+len)*len/2;\n                    }else{\n                        ll l1=l,r1=r,mid;\n                        while(l1<=r1){\n                            mid=(l1+r1)/2;\n                            bool ok=(getl(mid)>=l);\n                            if(ok){\n                                r1=mid-1;\n                            }else{\n                                l1=mid+1;\n                            }\n                        }\n                        //l1\n                        ll poss=l1;//\u4ece\u5de6\u5f80\u53f3\u7b2c\u4e00\u4e2a>=l\n                        //cout<<\"poss:\"<<poss<<endl;\n                        //l,poss-1  <l\n                        //pos r   >=l\n                        ll len2=(poss-l);\n                        ans[i]=(len2+1)*len2/2;\n                        ans[i]+=getsum1(poss,r);\n                    }\n                }\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1723951134",
    "subm_id": "556403469"
}