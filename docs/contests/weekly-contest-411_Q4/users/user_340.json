{
    "username": "crimsonred",
    "submission": "class Solution {\npublic:\n    vector<long long> countKConstraintSubstrings(string s, int k, vector<vector<int>>& queries) {\n        int n = s.length();\n        vector<int> p1(n);\n        vector<int> p0(n);\n        p1[0] = s[0] == '1';\n        p0[0] = s[0] == '0';\n        for (int i = 1; i < n; ++i) {\n            p1[i] = p1[i - 1] + (s[i] == '1');\n            p0[i] = p0[i - 1] + (s[i] == '0');\n        }\n\n        vector<int> lmax(n);\n        for (int l = 0; l < n; ++l) {\n            int low = l;\n            int high = n - 1;\n            while (low < high) {\n                int mid = low + (high - low + 1) / 2;\n                int ones = p1[mid] - (l > 0 ? p1[l - 1] : 0);\n                int zeroes = p0[mid] - (l > 0 ? p0[l - 1] : 0);\n                if (ones <= k || zeroes <= k) {\n                    low = mid;\n                } else {\n                    high = mid - 1;\n                }\n            }\n\n            lmax[l] = low;\n        }\n\n        vector<long long> lpref(n);\n        lpref[0] = lmax[0] + 1;\n        for (int i = 1; i < n; ++i) {\n            lpref[i] = lpref[i - 1] + lmax[i] - i + 1;\n        }\n\n        int q = queries.size();\n        vector<long long> answer(q);\n        for (int query = 0; query < q; ++query) {\n            int l = queries[query][0];\n            int r = queries[query][1];\n            int low = l;\n            int high = r;\n            // find leftmost i s.t. [i, r] is valid\n            while (low < high) {\n                int mid = low + (high - low) / 2;\n                if (lmax[mid] >= r) {\n                    high = mid;\n                } else {\n                    low = mid + 1;\n                }\n            }\n\n            long long len = r - low + 1;\n            long long ans = (len * (len + 1)) / 2;\n            if (low > l) {\n                ans += lpref[low - 1] - (l > 0 ? lpref[l - 1] : 0);\n            }\n            answer[query] = ans;\n        }\n\n        return answer;\n    }\n};",
    "submit_ts": "1723951658",
    "subm_id": "1359776930"
}