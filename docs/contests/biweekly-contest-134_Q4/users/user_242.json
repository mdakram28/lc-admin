{
    "username": "Aylup",
    "submission": "#define TMID (tl + (tr - tl) / 2)\n#define TLEFT (tn + 1)\n#define TRIGHT (tn + 2 * (TMID - tl + 1))\nclass Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        using ll = long long;\n        int n = nums.size();\n        ll all =  (1ll << 32) - 1;\n        std::vector<int> tree(2 * n, all);\n        auto rangeAnd = [&](ll rq, ll x) {\n            ll lq = 0;\n            auto f = [&](auto &&f, ll tn, ll tl, ll tr) -> void {\n                if (rq < tl || tr < lq) {\n                } else if (lq <= tl && tr <= rq) {\n                    tree[tn] &= x;\n                } else {\n                    f(f, TLEFT, tl, TMID);\n                    f(f, TRIGHT, TMID + 1, tr);\n                }\n            };\n            return f(f, 0, 0, n - 1);\n        };\n        \n        auto query = [&](ll i) {\n            auto f = [&](auto &&f, ll tn, ll tl, ll tr) -> ll {\n                if (tl == tr) {\n                    return nums[tl];\n                } else if (i <= TMID) {\n                    return tree[tn] & f(f, TLEFT, tl, TMID);\n                }\n                return tree[tn] & f(f, TRIGHT, TMID + 1, tr);\n            };\n            return f(f, 0, 0, n - 1);\n        };\n        \n        ll ans = 0;\n        for (int i = 0; i < n; ++i) {\n            rangeAnd(i, nums[i]);\n            int l = 0, r = i + 1;\n            while (l < r) {\n                int m = l + (r - l) / 2;\n                if (query(m) > k) {\n                    r = m;\n                } else {\n                    l = m + 1;\n                }\n            }\n            int gt = l;\n            l = -1, r = i;\n            while (l < r) {\n                int m = l + (r - l + 1) / 2;\n                if (query(m) < k) {\n                    l = m;\n                } else {\n                    r = m - 1;\n                }\n            }\n            int lt = l;\n            ans += std::max(0, gt - lt - 1);\n        }\n        \n        return ans;\n    }\n};",
    "submit_ts": "1720278830",
    "subm_id": "1311726125"
}