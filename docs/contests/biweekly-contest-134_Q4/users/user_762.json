{
    "username": "raghu30",
    "submission": "class Solution {\npublic:\n    #define ll long long\n    \n    ll getAnd(vector<vector<ll>> &pre, ll l, ll r) {\n        ll ans = 0;\n        for(int j=31; j>=0; j--) {\n            if(pre[r][j]-pre[l-1][j] >= r-l+1) {\n                ans = ans | (1<<j);\n            }\n        }\n\n        return ans;\n    }\n\n    vector<vector<ll>> query(vector<ll> a) {\n        reverse(a.begin(), a.end());\n        a.push_back(0);\n        reverse(a.begin(), a.end());\n        int n = a.size();\n        vector<vector<ll>> pre(n+1, vector<ll>(32, 0));\n        for(int i=1; i<=n; i++) {\n            ll el = a[i];\n            for(int j=0; j<31; j++) {\n                if((el>>j)&1) {\n                    pre[i][j] = 1;\n                }\n                if(i > 1) {\n                    pre[i][j] += pre[i-1][j];\n                }\n            }\n        }\n        return pre;\n    }\n    \n    ll gfi(vector<vector<ll>> &pre, ll st, ll k) {\n        ll lo = st;\n        ll hi = pre.size()-2;\n        \n        while(hi - lo > 1) {\n            ll mid = (lo + hi)/2;\n            if(getAnd(pre, st, mid) <= k) {\n                hi = mid;\n            } else {\n                lo = mid;\n            }\n        }\n        \n        if(getAnd(pre, st, lo) == k) {\n            return lo;\n        }\n        if(getAnd(pre, st, hi) == k) {\n            return hi;\n        }\n        return -1;\n    }\n    \n    ll gli(vector<vector<ll>> &pre, ll st, ll k) {\n        ll lo = st;\n        ll hi = pre.size()-2;\n        \n        while(hi - lo > 1) {\n            ll mid = (lo + hi)/2;\n            if(getAnd(pre, st, mid) >= k) {\n                lo = mid;\n            } else {\n                hi = mid;\n            }\n        }\n        \n        if(getAnd(pre, st, hi) == k) {\n            return hi;\n        }\n        if(getAnd(pre, st, lo) == k) {\n            return lo;\n        }\n        return -1;\n    }\n\n    long long countSubarrays(vector<int>& nums, int k) {\n        int n = nums.size();\n        vector<ll> num;\n        for(auto el:nums) num.push_back(el);\n        vector<vector<ll>> pre = query(num);\n        ll ans = 0;\n        \n        for(ll i=1; i<=n; i++) {\n            ll st = gfi(pre, i, k);\n            ll ed = gli(pre, i, k);\n            // cout << i << \" \" << st << \" \" << ed << endl;\n            if(st == -1) {\n                continue;\n            }\n            ans = ans + (ed - st + 1);\n        }\n        \n        return ans;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "submit_ts": "1720279518",
    "subm_id": "1311754399"
}