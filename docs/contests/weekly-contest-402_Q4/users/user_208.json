{
    "username": "Aylup",
    "submission": "class Solution {\npublic:\n    vector<int> countOfPeaks(vector<int>& nums, vector<vector<int>>& queries) {\n        int n = nums.size();\n        std::vector<int> tree(4 * n + 10, false);\n        auto update = [&](auto &update, int i, int x, int tn, int tl, int tr) -> void {\n            if (tl == tr) {\n                tree[tn] = x;\n            } else {\n                int tm = tl + (tr - tl) / 2;\n                if (i <= tm) {\n                    update(update, i, x, 2 * tn, tl, tm);\n                } else {\n                    update(update, i, x, 2 * tn + 1, tm + 1, tr);\n                }\n                tree[tn] = tree[2 * tn] + tree[2 * tn + 1];\n            }\n        };\n        auto query = [&](auto &query, int lq, int rq, int tn, int tl, int tr) -> int {\n            if (rq < tl || tr < lq) {\n                return 0;\n            } else if (lq <= tl && tr <= rq) {\n                return tree[tn];\n            } else {\n                int tm = tl + (tr - tl) / 2;\n                return query(query, lq, rq, 2*tn, tl, tm) + query(query, lq, rq, 2*tn + 1, tm + 1, tr);\n            }\n        };\n        \n        auto fix_peaks = [&](int l, int r) {\n            l = std::max(0, l);\n            r = std::min(n - 1, r);\n            for (int i = l + 1; i < r; ++i) {\n                int x = !!(nums[i - 1] < nums[i] && nums[i] > nums[i + 1]);\n                update(update, i, x, 1, 0, n - 1);\n            }\n        };\n        \n        fix_peaks(0, n - 1);\n        \n        std::vector<int> ans;\n        for (auto &q : queries) {\n            if (q[0] == 1) {\n                int l = q[1], r = q[2];\n                int other = query(query, l, l, 1, 0, n - 1);\n                if (l != r) {\n                    other += query(query, r, r, 1, 0, n - 1);\n                }\n                ans.push_back(query(query, l, r, 1, 0, n -1) - other);\n            } else {\n                int i = q[1], x = q[2];\n                nums[i] = x;\n                fix_peaks(i - 3, i + 3);\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": 1718507084.0
}