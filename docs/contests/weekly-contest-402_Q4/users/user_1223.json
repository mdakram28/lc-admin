{
    "username": "kai-ju-na-tiao-gou",
    "submission": "struct BIT {\n    vector<int> vec;\n\n    BIT(int n) : vec(vector<int>(n + 10, 0)) {}\n\n    int lowbit(int x) {\n        return x & -x;\n    }\n    void add(int id, int v) {\n        while (id < vec.size()) {\n            vec[id] += v;\n            id += lowbit(id);\n        }\n    }\n    int query(int id) {\n        int res = 0;\n        while (id > 0) {\n            res += vec[id];\n            id -= lowbit(id);\n        }\n        return res;\n    }\n};\n\nclass Solution {\npublic:\n    vector<int> countOfPeaks(vector<int>& nums, vector<vector<int>>& queries) {\n        int n = nums.size();\n        BIT bit(n);\n        for (int i = 1; i < n; ++i) {\n            if (i + 1 < n && nums[i] > nums[i - 1] && nums[i] > nums[i + 1]) {\n                bit.add(i + 1, 1);\n            }\n        }\n        vector<int> ans;\n\n        for (auto& q : queries) {\n            int i = q[1];\n            int j = q[2];\n            if (q[0] == 1) {\n                auto v = bit.query(j + 1) - bit.query(i);\n                if (i - 1 >= 0 && i + 1 < n && nums[i - 1] < nums[i] && nums[i] > nums[i + 1]) {\n                    --v;\n                }\n                if (i != j) {\n                    i = j;\n                    if (i - 1 >= 0 && i + 1 < n && nums[i - 1] < nums[i] && nums[i] > nums[i + 1]) {\n                        --v;\n                    }\n                }\n                \n                ans.push_back(v);\n            } else {\n                if (i - 1 >= 0 && i + 1 < n && nums[i - 1] < nums[i] && nums[i] > nums[i + 1]) {\n                    bit.add(i + 1, -1);\n                }\n                if (i - 2 >= 0 && nums[i - 2] < nums[i - 1] && nums[i - 1] > nums[i]) {\n                    bit.add(i, -1);\n                }\n                if (i + 2 < n && nums[i] < nums[i + 1] && nums[i + 1] > nums[i + 2]) {\n                    bit.add(i + 2, -1);\n                }\n                nums[i] = j;\n                if (i - 1 >= 0 && i + 1 < n && nums[i - 1] < nums[i] && nums[i] > nums[i + 1]) {\n                    bit.add(i + 1, 1);\n                }\n                if (i - 2 >= 0 && nums[i - 2] < nums[i - 1] && nums[i - 1] > nums[i]) {\n                    bit.add(i, 1);\n                }\n                if (i + 2 < n && nums[i] < nums[i + 1] && nums[i + 1] > nums[i + 2]) {\n                    bit.add(i + 2, 1);\n                }\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": 1718507840.0
}