{
    "username": "zrts",
    "submission": "class Solution {\n    // [L, R]: count of peaks in [L+1, R-1]; decide L, R is peak when merge\n    int a[100005];\n    int sum[100005*4];\n    int merge(int o, int s1,int s2, int l, int mid, int r){\n        int s = s1 + s2;\n        // check mid/mid+1 is peak \n        if(mid-1>=l && mid+1<=r && a[mid]>a[mid-1] && a[mid]>a[mid+1]) s++;\n        if(mid+1-1>=l && mid+1+1 <= r && a[mid+1] > a[mid + 1 - 1] && a[mid+1] > a[mid+1+1]) s++;\n        return s;\n    }\n    void bd(int o, int l,int r){\n        if(l==r){\n            sum[o] = 0;\n        }else{\n            int mid = (l+r)/2;\n            bd(o<<1,l,mid);\n            bd(o<<1|1,mid+1,r);\n            sum[o] = merge(o, sum[o<<1], sum[o<<1|1],l, mid,r);\n        }\n    }\n    void upd(int o,int l,int r, int pos){\n        if(l==r){\n            sum[o] = 0;\n        }else{\n            int mid = (l+r)/2;\n            if(pos<=mid) upd(o<<1,l,mid, pos);\n            else upd(o<<1|1,mid+1,r, pos);\n            sum[o] = merge(o, sum[o<<1], sum[o<<1|1],l, mid,r);\n        }\n    }\n    int query(int o,int l,int r, int L, int R){\n        if(l==L && r==R) return sum[o];\n        else{\n            int mid=(l+r)/2;\n            if(R<=mid) return query(o<<1,l,mid,L,R);\n            else if(L>mid) return query(o<<1|1,mid+1,r,L,R);\n            else{\n                int s1 = query(o<<1,l,mid,L,mid);\n                int s2 = query(o<<1|1,mid+1,r,mid+1,R);\n                return merge(o, s1, s2, L, mid, R);\n            }\n        }\n    }\npublic:\n    vector<int> countOfPeaks(vector<int>& nums, vector<vector<int>>& queries) {\n        int n = nums.size();\n        for(int i=1;i<=n;i++) a[i] = nums[i-1];\n        bd(1,1,n);\n        vector<int> ans;\n        for(auto q:queries){\n            if(q[0] == 1){\n                ans.push_back(query(1,1,n, q[1]+1, q[2]+1));\n            }else{\n                a[q[1]+1] = q[2];\n                upd(1,1,n, q[1]+1);\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": 1718506576.0
}