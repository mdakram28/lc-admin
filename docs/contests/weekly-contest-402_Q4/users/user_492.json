{
    "username": "tzhuan",
    "submission": "class Solution {\npublic:\n    vector<int> countOfPeaks(vector<int>& nums, vector<vector<int>>& queries) {\n        const int N = nums.size();\n        vector<int> st(2 * N, 0);\n        auto query = [&](int b, int e) { // b <= i < e\n            const int N = st.size() / 2;\n            int ans = 0;\n            for (b += N, e += N; b < e; b /= 2, e /= 2) {\n                if (b % 2 == 1) ans += st[b++];\n                if (e % 2 == 1) ans += st[--e];\n            }\n            return ans;\n        };\n        auto update = [&](int i, int v) {\n            // cout << i << \": \" << v << endl;\n            const int N = st.size() / 2;\n            i += N;\n            st[i] = v;\n            for (; i > 1; i /= 2) st[i / 2] = st[i] + st[i ^ 1];\n        };\n        vector<int> ans; ans.reserve(queries.size());\n        auto is_peak = [&N](const vector<int>& nums, int i) {\n            if (i <= 0 or i >= N - 1) return false;\n            // cout << \"is_peak: \" << nums[i - 1] << \" \" << nums[i] << \" \" << nums[i + 1] << endl;\n            return nums[i] > nums[i - 1] and nums[i] > nums[i + 1];\n        };\n        auto tmp = nums;\n        for (int i = 1; i < N - 1; ++i) if (is_peak(nums, i)) update(i, 1);\n        for (const auto& q: queries) {\n            if (q[0] == 1) ans.push_back(query(q[1] + 1, q[2]));\n            else {\n                auto i = q[1], v = q[2];\n                tmp[i] = v;\n                for (int j = i - 1; j <= i + 1; ++j) {\n                    auto src = is_peak(nums, j), dst = is_peak(tmp, j);\n                    // cout << i << \" \" << v << \": \" << j << \": \" << src << \" \" << dst << endl;\n                    if (src and !dst) update(j, 0);\n                    else if (!src and dst) update(j, 1);\n                }\n                nums[i] = v;\n                // for (int i = N; i < st.size(); ++i) cout << st[i] << \" \"; cout << endl;\n                swap(nums, tmp);\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": 1718507376.0
}