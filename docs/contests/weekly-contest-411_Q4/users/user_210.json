{
    "username": "sheldon",
    "submission": "class Solution {\n    typedef long long ll;\n    int search(vector<int>&pos,int l,int r){\n        int left = l;\n        while(l<r){\n            int mid = (l+r)>>1;\n            if(pos[mid] >= left){\n                r = mid;\n            }else{\n                l = mid+1;\n            }\n        }\n        return l;\n    }\npublic:\n    vector<long long> countKConstraintSubstrings(string s, int k, vector<vector<int>>& queries) {\n        int n = s.size();\n        vector<int>pos(n,0);//\n        int cnt[2] = {0};\n        int st = 0;\n        for(int j = 0;j<n;j++){\n            int idx = s[j]-'0';\n            cnt[idx]++;\n            while(st<j && (cnt[0]>k && cnt[1]>k)){\n                idx = s[st]-'0';\n                cnt[idx]--;\n                st++;\n            }\n            pos[j] = st;\n            //cout<<j<<\" \"<<st<<endl;\n        }\n        vector<ll>presum(n+1,0);\n        for(int i = 0;i<n;i++){\n            int sum = (i-pos[i]+1);\n            presum[i+1] = presum[i]+sum;\n        }\n        int m = queries.size();\n        vector<ll>ret(m,0);\n        for(int i = 0;i<m;i++){\n            int l = queries[i][0],r = queries[i][1];\n            //cout<<l<<\" \"<<r<<\"rrrrrrrrr\"<<endl;\n            if(pos[l] < l){\n                //\u4e8c\u5206\u67e5\u627e\u7b2c\u4e00\u4e2a\u843d\u5728\u533a\u95f4\u5185\u7684\n                if(pos[r] < l){\n                    int k = r-l+1;\n                    ret[i] = 1LL*k*(k+1)/2;\n                }else{\n                    int p = search(pos,l,r);\n                    //[l,p-1] \u8ba1\u7b97\u548c\n                    //[p,r]\u8ba1\u7b97\u524d\u7f00\u548c\n                    ret[i] = presum[r+1]-presum[p];\n                    int k = p-l;\n                    //cout<<ret[i]<<\" \"<<k<<\" \"<<p<<endl;\n                    ret[i] += 1LL*k*(k+1)/2;\n                }\n            }else{\n                ret[i] = presum[r+1]-presum[l];\n            }\n        }\n        return ret;\n    }\n};",
    "submit_ts": "1723950557",
    "subm_id": "556399808"
}