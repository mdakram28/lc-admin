{
    "username": "TsReaper",
    "submission": "class Solution {\npublic:\n    vector<long long> countKConstraintSubstrings(string s, int K, vector<vector<int>>& queries) {\n        int n = s.size();\n\n        int f[n + 1];\n        int cnt[2] = {0};\n        for (int i = 1, j = 1; i <= n; i++) {\n            cnt[s[i - 1] - '0']++;\n            while (cnt[0] > K && cnt[1] > K) {\n                cnt[s[j - 1] - '0']--;\n                j++;\n            }\n            f[i] = j;\n        }\n\n        typedef pair<int, int> pii;\n        vector<pii> vec;\n        for (int i = 1; i <= n; i++) vec.push_back({f[i], i});\n        sort(vec.begin(), vec.end(), greater<pii>());\n\n        long long tree1[n + 1], tree2[n + 1];\n        memset(tree1, 0, sizeof(tree1)); memset(tree2, 0, sizeof(tree2));\n\n        auto lb = [&](int x) { return x & (-x); };\n\n        auto add = [&](long long *tree, int pos, int val) {\n            for (; pos <= n; pos += lb(pos)) tree[pos] += val;\n        };\n\n        auto query = [&](long long *tree, int pos) {\n            long long ret = 0;\n            for (; pos; pos -= lb(pos)) ret += tree[pos];\n            return ret;\n        };\n\n        int q = queries.size();\n        vector<array<int, 3>> qry;\n        for (int i = 0; i < q; i++) qry.push_back({queries[i][0] + 1, queries[i][1] + 1, i});\n        sort(qry.begin(), qry.end());\n\n        for (int i = 1; i <= n; i++) add(tree1, i, f[i]);\n        vector<long long> ans(q);\n        for (auto &arr : qry) {\n            int L = arr[0], R = arr[1], len = R - L + 1;\n            while (!vec.empty() && vec.back().first < L) {\n                int idx = vec.back().second;\n                add(tree1, idx, -f[idx]);\n                add(tree2, idx, 1);\n                vec.pop_back();\n            }\n            ans[arr[2]] = 1LL * (L + R) * len / 2 + len;\n            ans[arr[2]] -= query(tree1, R) - query(tree1, L - 1);\n            ans[arr[2]] -= (query(tree2, R) - query(tree2, L - 1)) * L;\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1723950839",
    "subm_id": "556401584"
}