{
    "username": "cp_126",
    "submission": "class Solution {\n    vector<int> c;\n    int n = 0;\n    void update(int ind, int delta) {\n        while (ind <= n) {\n            c[ind] += delta;\n            ind += ind & -ind;\n        }\n    }\n    int query(int ind) {\n        int ans = 0;\n        while (ind) {\n            ans += c[ind];\n            ind &= ind - 1;\n        }\n        return ans;\n    }\npublic:\n    vector<int> countOfPeaks(vector<int>& nums, vector<vector<int>>& queries) {\n        n = nums.size();\n\n        c.resize(n + 1);\n\n        vector<bool> ispeak(n, false);\n\n        for (int i = 1; i < n - 1; ++i) {\n            if (nums[i] > nums[i-1] && nums[i] > nums[i+1]) {\n                ispeak[i] = true;\n                update(i + 1, 1);\n            }\n        }\n\n        vector<int> ans;\n        for (vector<int>& q: queries) {\n            int op = q[0], p1 = q[1], p2 = q[2];\n            if (op == 1) {\n                int t = query(p2 + 1) - query(p1);\n                if (ispeak[p2]) --t;\n                if (p1 != p2 && ispeak[p1]) --t;\n                ans.push_back(t);\n            } else {\n                if (ispeak[p1]) {\n                    update(p1 + 1, -1);\n                    ispeak[p1] = false;\n                }\n                if (p1 > 0 && p1 + 1 < n && p2 > nums[p1-1] && p2 > nums[p1+1]) {\n                    update(p1 + 1, 1);\n                    ispeak[p1] = true;\n                }\n                \n                if (p1 > 0 && ispeak[p1-1]) {\n                    update(p1, -1);\n                    ispeak[p1-1] = false;\n                }\n\n                if (p1 > 1 && nums[p1-1] > nums[p1-2] && nums[p1-1] > p2) {\n                    update(p1, 1);\n                    ispeak[p1-1] = true;\n                }\n\n                if (ispeak[p1+1]) {\n                    update(p1 + 2, -1);\n                    ispeak[p1 + 1] = false;\n                }\n\n                if (p1 + 2 < n && nums[p1+1] > p2 && nums[p1+1] > nums[p1+2]) {\n                    update(p1 + 2, 1);\n                    ispeak[p1 + 1] = true;\n                }\n\n                nums[p1] = p2;\n\n            }\n        }\n\n        return ans;\n    }\n};",
    "submit_ts": 1718508022.0
}