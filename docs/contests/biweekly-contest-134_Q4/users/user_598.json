{
    "username": "Fishron",
    "submission": "class Solution:\n    def countSubarrays(self, nums: List[int], tar: int) -> int:\n        def doAnd(x,y):\n            return [e-1+a for e,a in zip(x,y)]\n        def undoAnd(x,y):\n            return [e+1-a for e,a in zip(x,y)]\n        def andVal(x):\n            return sum((e>0)*2**(len(x)-i-1) for i,e in enumerate(x))\n        \n        M=max(e.bit_length()for e in nums)\n        def lefts():\n            left=[None for _ in range(len(nums))]\n            beg=0\n            val=(2**M-1,[1]*M)\n            for end in range(len(nums)):\n                e=nums[end]\n                tabe=[*map(int,bin(e)[2:].zfill(M))]\n                val=(val[0]&e,doAnd(val[1],tabe))\n                if val[0]>tar:continue\n                while val[0]<tar and beg<end:\n                    tabeg=[*map(int,bin(nums[beg])[2:].zfill(M))]\n                    val1=undoAnd(val[1],tabeg)\n                    beg+=1\n                    val=(andVal(val1),val1)\n                if val[0]==tar:left[end]=beg\n            return left\n        def rights():\n            right=[None for _ in range(len(nums))]\n            beg=0\n            val=(2**M-1,[1]*M)\n            for end in range(len(nums)):\n                e=nums[end]\n                tabe=[*map(int,bin(e)[2:].zfill(M))]\n                val=(val[0]&e,doAnd(val[1],tabe))\n                if val[0]>tar:continue\n                while val[0]<=tar and beg<end:\n                    tabeg=[*map(int,bin(nums[beg])[2:].zfill(M))]\n                    val1=undoAnd(val[1],tabeg)\n                    beg+=1\n                    val=(andVal(val1),val1)\n                if val[0]==tar:\n                    right[end]=beg\n                if val[0]>tar and val[0]&nums[beg-1]==tar:\n                    beg-=1\n                    tabeg=[*map(int,bin(nums[beg])[2:].zfill(M))]\n                    right[end]=beg\n                    val=(val[0]&nums[beg],doAnd(val[1],tabeg))\n            return right\n        \n\n        return sum(a-e+1 if e!=None else 0 for e,a in zip(lefts(),rights()))\n\n        ",
    "submit_ts": "1720279565",
    "subm_id": "1311756338"
}