{
    "username": "Vaalarivan_P",
    "submission": "class FenTree { // thank you cp-algorithms!\n// o(logn)\npublic:\n    vector<int> B1, B2;\n    int N;\n\n    void fen_init(int n) {\n        N=4*n+10;   \n        B2.resize(N);\n        B1.resize(N);\n        for(int i=0; i<N; ++i) {\n            B1[i]=0; B2[i]=0;\n        }\n    }\n\n    void add(vector<int>& b, int idx, int x) {\n        while(idx<=N) {\n            b[idx]+=x;\n            idx+=idx&-idx;\n        }\n    }\n\n    void range_add(int l, int r, int x) {\n        add(B1, l, x);\n        add(B1, r+1, -x);\n        add(B2, l, x*(l-1));\n        add(B2, r+1, -x*r);\n    }\n\n    int sum(vector<int> &b, int idx) {\n        int total=0;\n        while(idx>0) {\n            total+=b[idx];\n            idx-=idx&-idx;\n        }\n        return total;\n    }\n\n    int prefix_sum(int idx) {\n        return sum(B1, idx)*idx-sum(B2, idx);\n    }\n\n    int range_sum(int l, int r) {\n        return prefix_sum(r)-prefix_sum(l-1);\n    }\n};\n\nclass Solution {\npublic:\n    vector<int> countOfPeaks(vector<int>& nums, vector<vector<int>>& queries) {\n        int n=nums.size();\n        FenTree f;\n        f.fen_init(n);\n        \n \n        \n        for(int i=1; i<n-1; ++i) {\n            if(nums[i]>nums[i-1]&&nums[i]>nums[i+1])\n            f.range_add(i+1, i+1,1);\n        }\n        vector<int> ans;\n        for(auto query : queries) {\n            if(query[0]==1) {\n                int l=query[1];\n                int r=query[2];\n                int res=f.range_sum(l+1,r+1);\n                if(l>0&&l<n-1) {\n                    if(nums[l]>nums[l-1]&&nums[l]>nums[l+1]) {\n                        res--;\n                    }\n                }\n                if(r<n-1&&r>0) {\n                    if(nums[r]>nums[r-1]&&nums[r]>nums[r+1]) {\n                        res--;\n                    }\n                }\n                ans.push_back(max(res,0));\n            } else {\n                int ind=query[1], val=query[2];\n                int prev=0, prevl=0, prevr=0;\n                if(ind>0&&ind<n-1) {\n                    if(nums[ind]>nums[ind-1]&&nums[ind]>nums[ind+1]) {\n                        prev=1;\n                    }\n                }\n                {\n                    int ind1=ind-1;\n                    if(ind1>0&&ind1<n-1) {\n                        if(nums[ind1]>nums[ind1-1]&&nums[ind1]>nums[ind1+1]) {\n                            prevl=1;\n                        }\n                    }\n                    \n                    ind1=ind+1;\n                    if(ind1>0&&ind1<n-1) {\n                        if(nums[ind1]>nums[ind1-1]&&nums[ind1]>nums[ind1+1]) {\n                            prevr=1;\n                        }\n                    }\n                }\n                \n                \n                \n                int curr=0, currl=0, currr=0;                \n                nums[ind]=val;\n                if(ind>0&&ind<n-1) {\n                    if(nums[ind]>nums[ind-1]&&nums[ind]>nums[ind+1]) {\n                        curr=1;\n                    }\n                }\n                {\n                    int ind1=ind-1;\n                    if(ind1>0&&ind1<n-1) {\n                        if(nums[ind1]>nums[ind1-1]&&nums[ind1]>nums[ind1+1]) {\n                            currl=1;\n                        }\n                    }\n                    \n                    ind1=ind+1;\n                    if(ind1>0&&ind1<n-1) {\n                        if(nums[ind1]>nums[ind1-1]&&nums[ind1]>nums[ind1+1]) {\n                            currr=1;\n                        }\n                    }\n                }\n                if(prev==0&&curr==1) {\n                    f.range_add(ind+1, ind+1, 1);\n                }\n                if(prev==1&&curr==0) f.range_add(ind+1,ind+1,-1);\n                if(prevl==0&&currl==1) {\n                    f.range_add(ind, ind, 1);\n                }\n                if(prevl==1&&currl==0) f.range_add(ind,ind,-1);\n                if(prevr==0&&currr==1) {\n                    f.range_add(ind+2, ind+2, 1);\n                }\n                if(prevr==1&&currr==0) f.range_add(ind+2,ind+2,-1);\n                \n                \n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": 1718508309.0
}