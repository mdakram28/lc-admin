{
    "username": "friedall",
    "submission": "#include <iostream>\n#include <cmath>\n#include <unordered_map>\n#include <array>\n#include <vector>\n#define ll long long\n\nusing namespace std;\n\nclass Solution {\npublic:\n    int minimumCost(string target, vector<string>& words, vector<int>& costs) {\n        ll rt = sqrt(50000), b1 = 31, b2 = 47, M1 = 1e9+7, M2 = 1e9+9, M = M1 * M2;\n        ll s1, s2, s, a, b, dp[50000];\n        array <ll, 2> hsh[50000], P[50000];\n        vector <array<ll, 3>> V;\n        unordered_map<ll, ll> len[rt];\n        s1 = s2 = 1;\n        for (int i=0; i<target.length(); ++i) {\n            s1 *= b1;\n            s2 *= b2;\n            s1 %= M1, s2 %= M2;\n            P[i] = {s1, s2};\n        }\n        int j = 0;\n        for (auto u : words) {\n            s1 = s2 = 0;\n            for (int i=0; i<u.length(); ++i) {\n                s1 *= b1, s2 *= b2;\n                s1 %= M1, s2 %= M2;\n                s1 += (u[i]-'a'+1);\n                s2 += (u[i]-'a'+1);\n                s1 %= M1, s2 %= M2;\n            }\n            s = s1 * M2 + s2;\n            if (u.length() <= rt) {\n                if (len[u.length()-1].count(s)) {\n                    len[u.length()-1][s] = min(len[u.length()-1][s], (ll)costs[j]);\n                }\n                else len[u.length()-1][s] = costs[j];\n            }\n            else {\n                V.push_back({(ll)u.length()-1, s, costs[j]});\n            }\n            ++j;\n        }\n        s1 = s2 = 0;\n        for (int i=0; i<target.length(); ++i) {\n            dp[i] = 1e18;\n            s1 *= b1, s2 *= b2;\n            s1 %= M1, s2 %= M2;\n            s1 += (target[i]-'a'+1);\n            s2 += (target[i]-'a'+1);\n            s1 %= M1, s2 %= M2;\n            hsh[i] = {s1, s2};\n            for (int j=0; j<=min((ll)i, rt-1); ++j) {\n                a = s1, b = s2;\n                if (i != j) {\n                    a -= hsh[i-j-1][0] * P[j][0] % M1;\n                    b -= hsh[i-j-1][1] * P[j][1] % M2;\n                    (a += M1) %= M1;\n                    (b += M2) %= M2;\n                }\n                s = a * M2 + b;\n                if (len[j].count(s)) {\n                    if (i == j) dp[i] = min(dp[i], len[j][s]);\n                    else dp[i] = min(dp[i], dp[i-j-1] + len[j][s]);\n                }\n            }\n            for (auto [x, y, z] : V) {\n                a = s1, b = s2;\n                if (i > x) {\n                    a -= hsh[i-x-1][0] * P[x][0] % M1;\n                    b -= hsh[i-x-1][1] * P[x][1] % M2;\n                    (a += M1) %= M1;\n                    (b += M2) %= M2;\n                }\n                s = a * M2 + b;\n                if (s == y) {\n                    if (i == x) dp[i] = min(dp[i], z);\n                    else dp[i] = min(dp[i], dp[i-x-1] + z);\n                }\n            }\n        }\n        if (dp[target.length()-1] < (ll)1e11) return dp[target.length()-1];\n        else return -1;\n    }\n};",
    "submit_ts": "1720321404",
    "subm_id": "1312322012"
}