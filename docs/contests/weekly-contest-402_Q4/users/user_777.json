{
    "username": "ihgazi",
    "submission": "class Solution {\npublic:\n    /**\n     * Point update max-tree\n     * Range queries of form [l,r)\n     * Array must be 0-indexed\n     */\n    template <typename T> struct SegTree {\n        vector<T> tree;\n        static constexpr T unit = 0;\n        int n;\n        SegTree(int n = 0, T def = unit): tree(2*n, def), n(n) {}\n        T f(T a, T b) { return a+b; }\n        void update(int pos, T val) {\n            for (tree[pos += n] = val; pos /= 2;)\n                tree[pos] = f(tree[2*pos], tree[2*pos+1]);\n        }\n        T query(int l, int r) {\n            T rl = unit, rr = unit;\n            for (l += n, r += n; l < r; l /= 2, r /= 2) {\n                if (l%2) rl = f(rl, tree[l++]);\n                if (r%2) rr = f(tree[--r], rr);\n            }\n            return f(rl,rr);\n        }\n    };\n    \n    inline int isPeak(vector<int> &nums, int i) {\n        if (i>0 && i<nums.size()-1)\n            return (nums[i]>nums[i-1] && nums[i]>nums[i+1]);\n        return 0;\n    }\n    \n    vector<int> countOfPeaks(vector<int>& nums, vector<vector<int>>& queries) {\n        int n = nums.size();\n        \n        SegTree<int> tree(n);\n        vector<int> peaks(n,0);\n        for (int i = 0; i < n; i++) {\n            peaks[i] = isPeak(nums,i);\n            tree.update(i,peaks[i]);\n        }\n    \n        vector<int> ans;\n        for (auto &q: queries) {\n            if (q[0]==1) {\n                int cnt = tree.query(q[1],q[2]+1);\n                cnt -= peaks[q[1]];\n                if (q[1]!=q[2]) cnt -= peaks[q[2]];\n                ans.push_back(cnt);\n            }\n            else {\n                nums[q[1]] = q[2];\n                vector<int> idx = {q[1]-1,q[1],q[1]+1};\n                for (auto &it: idx) {\n                    if (it<0 || it>=n) continue;\n                    peaks[it] = isPeak(nums,it);\n                    tree.update(it,peaks[it]);\n                }\n            }\n        }\n    \n        return ans;\n    }\n};",
    "submit_ts": 1718508147.0
}