{
    "username": "Heisenberg2003",
    "submission": "class Solution {\npublic:\n    int findidx(vector<vector<int>>&countset,int k,int piv)\n    {\n        vector<int>tosub(30,0);\n        if((piv-1)>=0)\n        {\n            for(int i=0;i<30;i++)\n            {\n                tosub[i]=countset[piv-1][i];\n            }\n        }\n        int andvalue=0,left=piv,right=countset.size()-1;\n        for(int i=0;i<30;i++)\n        {\n            if((countset[right][i]-tosub[i])==(right-piv+1))\n            {\n                andvalue|=(1<<i);\n            }\n        }\n        if(andvalue>k)\n        {\n            return -1;\n        }\n        while(left<=right)\n        {\n            int mid=(left+right)/2;\n            andvalue=0;\n            for(int i=0;i<30;i++)\n            {\n                if((countset[mid][i]-tosub[i])==(mid-piv+1))\n                {\n                    andvalue|=(1<<i);\n                }\n            }\n            if(andvalue>k)\n            {\n                left=mid+1;\n            }\n            else\n            {\n                right=mid-1;\n            }\n        }\n        return (left);\n    }\n    long long ANDatmostK(int k,vector<int>&nums)\n    {\n        long long ans=0;\n        vector<vector<int>>countset(nums.size(),vector<int>(31,0));\n        for(int i=0;i<nums.size();i++)\n        {\n            for(int j=0;j<31;j++)\n            {\n                if(((1<<j)&nums[i])>0)\n                {\n                    countset[i][j]++;\n                }\n                if(i>0)\n                {\n                    countset[i][j]+=countset[i-1][j];\n                }\n            }\n        }\n        for(int i=0;i<nums.size();i++)\n        {\n            int idx=findidx(countset,k,i);\n            if(idx!=(-1))\n            {\n                ans+=(nums.size()-idx);\n            }\n        }\n        return ans;\n    }\n    long long countSubarrays(vector<int>& nums, int k) {\n        return ANDatmostK(k,nums)-ANDatmostK(k-1,nums);\n    }\n};",
    "submit_ts": "1720279620",
    "subm_id": "1311758524"
}