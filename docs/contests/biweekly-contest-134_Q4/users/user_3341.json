{
    "username": "ssayzx",
    "submission": "class Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        using ll = long long;\n\n        int n = nums.size();\n        const int N = 31;\n        vector<int> kbits;\n\n        for (int i = 0; i < N; i++) {\n            if (k & (1 << i)) kbits.push_back(i);\n        }\n\n        vector<vector<int>> sum0(n + 1, vector<int>(N, 0));\n        for (int i = 1; i <= n; i++) {\n            int v = nums[i - 1];\n            sum0[i] = sum0[i - 1];\n            for (int j = 0; j < N; j++) {\n                if (!(v & (1 << j))) sum0[i][j]++;\n            }\n        }\n\n        auto check = [&](int a, int b) {\n            for (auto i : kbits) {\n                if (sum0[b + 1][i] - sum0[a][i]) return false;\n            }\n            return true;\n        };\n\n        auto cal = [&](int a, int b) {\n            int ans = 0;\n            for (int i = 0; i < N; i++) {\n                if (sum0[b + 1][i] - sum0[a][i]) continue;\n                ans |= (1 << i);\n            }\n            return ans;\n        };\n\n        auto find = [&](int a) {\n            int l = a, r = n - 1, ans = n;\n            while (l <= r) {\n                int m = (l + r) >> 1;\n                auto v = cal(a, m);\n                if (v == k) ans = m, r = m -1;\n                else if (v > k) l = m + 1;\n                else r = m - 1;\n            }\n            return ans;\n        };\n\n        auto count = [&](int a) {\n            int l = a, r = n - 1, ans = a;\n            while (l <= r) {\n                int m = (l + r) >> 1;\n                auto chk = check(a, m);\n                if (chk) ans = m, l = m + 1;\n                else r = m - 1;\n            }\n            return ans - a + 1;\n        };\n        // cout << \"--- \" << cal(3, 3) << endl;\n        // return 0;\n\n        ll ans = 0, j = 0;\n        for (int i = 0, j = i; i < n; i++) {\n            int p = find(i);\n            // cout << i << ends << p << endl;\n            if (p < n) ans += count(p);\n        }\n\n        return ans;\n    }\n};",
    "submit_ts": "1720281140",
    "subm_id": "544574649"
}