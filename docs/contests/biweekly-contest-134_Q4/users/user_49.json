{
    "username": "nevergiveup",
    "submission": "class Solution {\n\n    private int and(int l , int r) {\n        int ans = 0;\n        for (int i = 0;i <= 30;i ++) {\n            long all = countAcc[r][i];\n            if (l - 1 >= 0) {\n                all -= countAcc[l - 1][i];\n            }\n            if (all == r - l + 1) {\n                ans = ans | (1 << i);\n            }\n        }\n        return ans;\n    }\n\n    private int lower(int cur , int k) {\n        int l = 0 , r = cur + 1;\n        while (l < r) {\n            int mid = (l + r) / 2;\n            if (and(mid , cur) < k) {\n                l = mid + 1;\n            } else {\n                r = mid;\n            }\n        }\n        if (l <= cur && and(l, cur) == k) {\n            return l;\n        } else {\n            return - 1;\n        }\n    }\n\n    private int upper(int cur , int k) {\n        int l = 0 , r = cur + 1;\n        while (l < r) {\n            int mid = (l + r) / 2;\n            if (and(mid , cur) <= k) {\n                l = mid + 1;\n            } else {\n                r = mid;\n            }\n        }\n        if (r - 1 >= 0 && and(r - 1 , cur) == k) {\n            return r - 1;\n        } else {\n            return - 1;\n        }\n    }\n\n    private long[][] countAcc;\n\n    public long countSubarrays(int[] nums, int k) {\n        int i , j , n = nums.length;\n        countAcc = new long[n][31];\n        for (i = 0;i < n;i ++) {\n            for (j = 0;j <= 30;j ++) {\n                if ((nums[i] & (1 << j)) != 0) {\n                    countAcc[i][j] ++;\n                }\n            }\n            if (i > 0) {\n                for (j = 0;j <= 30;j ++) {\n                    countAcc[i][j] += countAcc[i - 1][j];\n                }\n            }\n        }\n        // check result\n        long ans = 0;\n        for (i = 0;i < n;i ++) {\n            int l = lower(i , k) , r = upper(i , k);\n            if (l >= 0 && r >= 0) {\n                ans += (r - l + 1);\n            }\n        }\n        return ans;\n    }\n\n\n}",
    "submit_ts": "1720277955",
    "subm_id": "1311687745"
}