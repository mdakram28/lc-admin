{
    "username": "qian-mo-dan-shang-k",
    "submission": "typedef long long LL;\n\nclass Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        int n = nums.size();\n        int a[n + 1];\n        for (int i = 1; i <= n; i ++)   a[i] = nums[i - 1];\n        \n        int s[n + 1][30];\n        memset(s, 0, sizeof s);\n        \n        LL res = 0;\n        for (int i = 1; i <= n; i ++) {\n            int x = a[i];\n            for (int j = 0; j < 30; j ++) \n                if (x >> j & 1)\n                    s[i][j] = 1;\n        }\n        for (int i = 1; i <= n; i ++) {\n            for (int j = 0; j < 30; j ++) \n                s[i][j] += s[i - 1][j];\n        }\n        \n        for (int i = 1; i <= n; i ++ ) {\n            int l = 1, r = i;\n            while (l < r) {\n                int mid = l + r >> 1;   // [mid, r]\n                int w = 0;\n                for (int j = 0; j < 30; j ++) {\n                    if (s[i][j] - s[mid - 1][j] == i - mid + 1) \n                        w += 1 << j;\n                }\n                if (w >= k) r = mid;\n                else    l = mid + 1;\n            }\n            \n            int s1 = 0;\n            int q = 0;\n            for (int j = 0; j < 30; j ++) {\n                if (s[i][j] - s[r - 1][j] == i - r + 1) \n                    q += 1 << j;\n            }\n            if (q == k) s1 = r;\n            \n            l = 1, r = i;\n            while (l < r) {\n                int mid = l + r + 1 >> 1;   // [mid, r]\n                int w = 0;\n                for (int j = 0; j < 30; j ++) {\n                    if (s[i][j] - s[mid - 1][j] == i - mid + 1) \n                        w += 1 << j;\n                }\n                if (w <= k) l = mid;\n                else    r = mid - 1;\n            }\n            q = 0;\n            for (int j = 0; j < 30; j ++) {\n                if (s[i][j] - s[r - 1][j] == i - r + 1) \n                    q += 1 << j;\n            }\n            int s2 = 0;\n            if (q == k) s2 = r;\n            if (s1 && s2)   res += s2 - s1 + 1;\n            // cout << s1 << ' ' << s2 << endl;\n        }\n        \n        return res;\n    }\n};",
    "submit_ts": "1720277569",
    "subm_id": "544557483"
}