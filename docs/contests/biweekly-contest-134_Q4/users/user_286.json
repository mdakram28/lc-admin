{
    "username": "man-ray",
    "submission": "class Solution {\n      static class RMQ {\n        public RMQ(int[] a) {\n            init(a);\n        }\n\n        int[][] f;\n\n        void init(int[] a) {\n            int n = a.length;\n            int m = log2(n) + 1;\n            f = new int[n][m];//f[i][j] = \u4ee5 i \u4e3a\u8d77\u70b9\uff0c\u957f\u5ea6\u4e3a 2 ^ j \u7684\u533a\u95f4\u7684\u6700\u5927\u503c\n            for (int i = 0; i < n; i++) f[i][0] = a[i];\n            for (int j = 1; j < m; j++) //\u679a\u4e3e\u533a\u95f4\u957f\u5ea6\n                for (int i = 0; i + (1 << j) - 1 < n; i++) //\u679a\u4e3e\u8d77\u70b9\n                    //f[i][j] = Math.max(f[i][j - 1], f[i + (1 << (j - 1))][j - 1]);\n                    f[i][j] = f[i][j - 1] & f[i + (1 << (j - 1))][j - 1];\n        }\n\n        //\u6c42\u533a\u95f4 [l,r] \u6700\u5927\u503c\n        int query(int l, int r) {\n            int k = log2(r - l + 1);\n            return f[l][k] & f[r - (1 << k) + 1][k];\n        }\n\n        //\u6c42 log2(X)\n        int log2(long x) {\n            return (int) (Math.log(x) / Math.log(2));\n        }\n    }\n\n\n    static long countSubarrays(int[] nums, int k) {\n        int n = nums.length;\n        RMQ rmq = new RMQ(nums);\n       /* for (int i = 0; i < n; i++) {\n            for (int j = i; j < n; j++) {\n                System.out.println(i + \" \" + j + \" \" + rmq.query(i, j));\n            }\n        }*/\n       long ans = 0;\n        for (int i = 0; i < n; i++) {\n            int l = i, r = n - 1, L = -1;\n            while (l <= r) {\n                int mid = l + r >> 1;\n                if (rmq.query(i, mid) <= k) {\n                    L = mid;\n                    r = mid - 1;\n                } else   l = mid + 1;\n            }\n            if (L == -1) continue;\n            l = i;\n            r = n - 1;\n            int R = -1;\n            while (l <= r) {\n                int mid = l + r >> 1;\n                if (rmq.query(i, mid) >= k) {\n                    R = mid;\n                    l = mid + 1;\n                } else r = mid - 1;\n            }\n            if(R !=-1) ans +=R-L+1;\n\n        }\n        return ans;\n\n\n\n    }\n}",
    "submit_ts": "1720276655",
    "subm_id": "544551583"
}