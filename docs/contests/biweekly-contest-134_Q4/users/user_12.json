{
    "username": "thomas-li",
    "submission": "\n#define rep(i, a, b) for(int i = a; i < (b); ++i)\n#define all(x) begin(x), end(x)\n#define sz(x) (int)(x).size()\ntypedef long long ll;\ntypedef pair<int, int> pii;\ntypedef vector<int> vi;\ntemplate<class T>\nstruct RMQ {\n\tvector<vector<T>> jmp;\n\tRMQ(const vector<T>& V) : jmp(1, V) {\n\t\tfor (int pw = 1, k = 1; pw * 2 <= sz(V); pw *= 2, ++k) {\n\t\t\tjmp.emplace_back(sz(V) - pw * 2 + 1);\n\t\t\trep(j,0,sz(jmp[k]))\n\t\t\t\tjmp[k][j] = jmp[k - 1][j]&jmp[k - 1][j + pw];\n\t\t}\n\t}\n\tT query(int a, int b) {\n\t\tassert(a < b); // or return inf if a == b\n\t\tint dep = 31 - __builtin_clz(b - a);\n\t\treturn jmp[dep][a]&jmp[dep][b - (1 << dep)];\n\t}\n};\nclass Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        int n = nums.size();\n        RMQ rmq(nums);\n        ll ans = 0;\n        for(int i = 0; i < n; i++){\n            int lo = i, hi = n-1;\n            while(lo < hi){\n                int mid = (lo+hi)/2;\n                if(rmq.query(i,mid+1) <= k) hi = mid;\n                else lo = mid+1;\n            }\n            if(rmq.query(i,lo+1) != k) continue;\n            int st = lo;\n            lo = i, hi = n-1;\n            while(lo < hi){\n                int mid = (lo+hi)/2;\n                if(rmq.query(i,mid+1) <= k-1) hi = mid;\n                else lo = mid+1;\n            }\n            if(rmq.query(i,lo+1) > k-1) lo++;\n            //cout << st << \" \" << i << \" \" << lo << \"\\n\";\n            ans += lo-st;\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1720276749",
    "subm_id": "1311630689"
}