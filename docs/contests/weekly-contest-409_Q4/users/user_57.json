{
    "username": "Ma_Lin",
    "submission": "const int L = 223; // change to 223!!!!!!!!!\n\nstruct Tkuai{\n    int st, ed, lzc, rzc, len;\n    int a[L + 1], sum[L + 1], chengsum[L + 1];\n}f[300], g[300];\n\nclass Solution {\npublic:\n    int n, K, top;\n    vector<int> a;\n    int fid[50005], nxt[300];\n    \n    void calc_f(int k){\n        int i, j, w;\n        for (i = 1; i <= L; ++i) f[k].a[i] = 0;\n        i = f[k].st;\n        while (i <= f[k].ed){\n            j = i + 1;\n            while (j <= f[k].ed && a[j] != a[j - 1]) ++j;\n            ++f[k].a[j - i];\n            if (i == f[k].st) f[k].lzc = j - i;\n            if (j == f[k].ed + 1) f[k].rzc = j - i;\n            i = j;\n        }\n        \n        for (i = L; i >= 1; --i){\n            f[k].sum[i] = f[k].a[i];\n            f[k].chengsum[i] = f[k].a[i] * (i + 1);\n            if (i + 1 <= L){\n                f[k].sum[i] += f[k].sum[i + 1];\n                f[k].chengsum[i] += f[k].chengsum[i + 1];\n            }\n        }\n    }\n    \n    void init_f(){\n        int i, j, st = 0, ed;\n        K = 0;\n        while (st < n){\n            ed = min(st + L - 1, n - 1);\n            f[K].st = st; f[K].ed = ed;\n            f[K].len = ed - st + 1;\n            for (i = st; i <= ed; ++i) fid[i] = K;\n            calc_f(K);\n            ++K;\n            st = ed + 1;\n        }\n        \n        for (i = 0; i < K; ++i) nxt[i] = (i + 1) % K;\n    }\n    \n    vector<int> numberOfAlternatingGroups(vector<int>& aa, vector<vector<int>>& Q) {\n        int i, j, k, l, yuani, pos, c, r, last, x, y;\n        vector<int> res;\n        a = aa;\n        n = a.size();\n        init_f();\n        for (auto q : Q)\n            if (q[0] == 1){\n                l = q[1];\n                r = 0;\n                // inner\n                for (i = 0; i < K; ++i)\n                    if (l <= f[i].len)\n                        r += f[i].chengsum[l] - f[i].sum[l] * l;\n                \n                // outer\n                // special who zc\n                for (i = 0; i < K; ++i){\n                    if (f[i].lzc < f[i].len)\n                        break;\n                    j = nxt[i];\n                    if (a[f[j].st] == a[f[i].ed]) break;\n                }\n                \n                if (i >= K) r = n;\n                else{\n                    yuani = i;\n                    bool first = true;\n                    while (true){\n                        int nowi = i;\n                        top = 1;\n                        g[0].st = f[i].ed - f[i].rzc + 1; g[0].ed = f[i].ed;\n                        while (true){\n                            j = nxt[i];\n                            if (a[f[j].st] == a[f[i].ed]) break;\n                            g[top].st = g[top - 1].ed + 1; g[top].ed = g[top - 1].ed + f[j].lzc;\n                            ++top;\n                            if (f[j].lzc < f[j].len) break;\n                            i = j;\n                        }\n                        \n                        last = g[top - 1].ed;\n                        for (j = 0; j < top; ++j){\n                            x = max(g[j].st, g[j].ed - l + 2);\n                            y = min(last + 1 - l, g[j].ed);\n                            if (x <= y) r += y - x + 1;\n                        }\n\n                        if (i == yuani && !first) break;\n                        first = false;\n                        if (i == nowi || top == 1 || f[i].lzc == f[i].len) i = nxt[i];\n                        if (i == yuani) break;\n                        // cout<<i<<\"---\"<<top<<\" \"<<K<<endl;\n                    }\n                }\n                \n                res.push_back(r);\n            }\n            else{\n                pos = q[1]; c = q[2];\n                if (c == a[pos]) continue;\n                a[pos] = c;\n                calc_f(fid[pos]);\n            }\n        \n        return res;\n    }\n};",
    "submit_ts": "1722743992",
    "subm_id": "1343804634"
}