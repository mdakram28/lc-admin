{
    "username": "suizhiyuan",
    "submission": "// cspell:ignore subarrays\n\nimpl Solution {\n    pub fn count_subarrays(nums: Vec<i32>, k: i32) -> i64 {\n        let k = k as u32;\n        let nums = nums.into_iter().map(|v| v as u32).map(|v| if v & k >= k {v & !k} else {u32::MAX}).collect::<Vec<_>>();\n    \n        let mut start = usize::MAX;\n        let mut result = 0;\n        for (i , &curr) in nums.iter().enumerate(){\n            if curr == u32::MAX {\n                if i > start {\n                    result += count_and_zero(&nums[start..i]);\n                }\n                start = usize::MAX;\n                continue;\n            }\n    \n            if start == usize::MAX {\n                start = i;\n            }\n        }\n        if start != usize::MAX {\n            result += count_and_zero(&nums[start..]);\n        }\n        \n        result\n    }\n}\n\nfn count_and_zero(nums: &[u32]) -> i64 {\n    let mut count_zero = vec![[0; 32]; nums.len()];\n    for (i , &v) in nums.iter().enumerate() {\n        for j in 0..32{\n            let prev = if i > 0 {count_zero[i-1][j]} else {0};\n            count_zero[i][j] = prev + if v & (1 << j) == 0 {1} else {0};\n        }\n    }\n    let len = nums.len();\n    let mut result = 0;\n\n    for (start , _ ) in nums.iter().enumerate(){\n        let end = binary_search(start, nums.len(), |end| {\n            for j in 0..32 {\n                let start_v = if start > 0 {count_zero[start-1][j]} else {0};\n                if count_zero[end][j] - start_v == 0 {\n                    return false;\n                }\n            }\n            true\n        });\n\n        result += (len -end) as i64;\n    }\n\n    result\n}\n\nfn binary_search(mut left: usize, mut right:usize, mut check: impl FnMut(usize) -> bool) -> usize\n{\n    while left < right - 1 {\n        let mid = (left + right) / 2;\n        if check(mid) {\n            right = mid;\n        } else {\n            left = mid;\n        }\n    }\n    \n    if check(left) {\n        left\n    } else {\n        right\n    }\n}\n",
    "submit_ts": "1720280175",
    "subm_id": "544570838"
}