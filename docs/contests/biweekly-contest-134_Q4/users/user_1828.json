{
    "username": "huangshan01",
    "submission": "class Solution:\n    def countSubarrays(self, nums: List[int], k: int) -> int:\n        # cand = []\n        # tmp = []\n        # for i in range(len(nums)):\n        #     if nums[i] & k >= k:\n        #         tmp.append(nums[i])\n        #     else:\n        #         if tmp:\n        #             cand.append(tmp)\n        #             tmp = []\n        # if tmp:\n        #     cand.append(tmp)\n        \n        def add(v):\n            for i in range(nb):\n                if v & (1 << i):\n                    ctl1[i] += 1\n                    ctr1[i] += 1\n                else:\n                    ctl0[i] += 1\n                    ctr0[i] += 1\n                    \n                    \n        def fun(arr):\n            n = len(arr)\n            res = 0\n            l = r = 0\n            cur = nums[0]\n            for i in range(n):\n                cur &= nums[i]\n                test = cur & k\n                # print(i, cur, test)\n                if test & k < k:\n                    l = r = i + 1\n                    cur = nums[i + 1] if i < n - 1 else 0\n                    ctr0.clear()\n                    ctr1.clear()\n                    ctl0.clear()\n                    ctl1.clear()\n                else:\n                    add(nums[i])\n                    if cur == k:\n                        while r < i:\n                            b = 1\n                            for j in range(nb):\n                                if j in st0:\n                                    if ctr0[j] > 1 or (nums[r] & (1 << j)):\n                                        pass\n                                    else:\n                                        b = 0\n                                        break\n                            if b:\n                                for j in range(nb):\n                                    if nums[r] & (1 << j):\n                                        ctr1[j] -= 1\n                                    else:\n                                        ctr0[j] -= 1\n                                r += 1\n                            else:\n                                break\n                        # print(i, r, l, r - l + 1, ctr0, ctr1)\n                        res += r - l + 1\n            return res\n            \n        nb = max(max(nums), k).bit_length()\n        st1 = set()\n        st0 = set()\n        for i in range(nb):\n            if not k & (1 << i):\n                st0.add(i)\n            else:\n                st1.add(i)\n        \n        ctr0 = Counter()\n        ctr1 = Counter()\n        ctl0 = Counter()\n        ctl1 = Counter()\n        return fun(nums)\n        ",
    "submit_ts": "1720281532",
    "subm_id": "1311828639"
}