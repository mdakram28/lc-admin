{
    "username": "k1384",
    "submission": "class Solution {\npublic:\n    #define ll long long\n    ll findval(ll mid,ll i,ll k, vector<vector<ll>>&pf){\n        ll val=0,len=mid-i+1;\n        for(ll j=0;j<=30;j++){\n            if(pf[mid+1][j]-pf[i][j]>=len)val+=(1LL<<j);\n        }\n        \n        return val;\n    }\n    ll func(ll i,ll x,vector<vector<ll>>&f){\n\n        ll mini=1e9;\n        for(ll j=0;j<=30;j++){\n            if(x&(1LL<<j)){\n                mini=min(mini,f[i][j]);\n            }\n        }\n        if(mini>=1e9)mini=0;\n        return mini;\n    }\n    long long countSubarrays(vector<int>& nums, int k) {\n         int n=nums.size();\n\n         ll ans=0,sum=0;\n\n         vector<vector<ll>>pf(n+1,vector<ll>(31,0));\n         for(int i=0;i<n;i++){\n            ll x=nums[i];\n            for(ll j=0;j<=30;j++){\n                if(x&(1<<j))pf[i+1][j]++;\n                pf[i+1][j]+=pf[i][j];\n            }\n         }\n         \n         vector<vector<ll>>f(n+1,vector<ll>(31,0));\n         for(ll i=n-1;i>=0;i--){\n             \n             for(ll j=0;j<=30;j++){\n                 ll bit=nums[i]&(1LL<<j);\n                 if(bit)f[i][j]=f[i+1][j]+1;\n             }\n         }\n         \n         \n         for(ll i=0;i<n;i++){\n             ll lo=i,hi=n-1;\n\n             while(hi-lo>1){\n                ll mid=(lo+hi)/2;\n                ll val=findval(mid,i,k,pf);\n                \n                if(val<=k)hi=mid;\n                else lo=mid;\n             }\n             \n            // if(findval(lo,i,k,pf)==k)ans+=f[lo];\n             //else if(findval(hi,i,k,pf)==k)ans+=f[hi];\n\n             if(findval(lo,i,k,pf)==k)ans+=func(lo,k,f);\n             else if(findval(hi,i,k,pf)==k)ans+=func(hi,k,f);\n             //cout<<ans<<\" \";\n             if(findval(lo,i,k,pf)==k)sum+=n-lo;\n             else if(findval(hi,i,k,pf)==k)sum+=n-hi;\n         }\n         \n         if(k==0)return sum;\n         return ans;\n    }\n};",
    "submit_ts": "1720280875",
    "subm_id": "1311805132"
}