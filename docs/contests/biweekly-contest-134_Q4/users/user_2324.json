{
    "username": "then00bprogrammer",
    "submission": "using ll = long long;\n\nclass Solution {\npublic:\n    ll countSubarrays(vector<int>& nums, int k) {\n        ll n = nums.size();\n        ll maxBits = log2(*max_element(nums.begin(), nums.end())) + 1;\n        vector<vector<ll>> prefix(n, vector<ll>(maxBits));\n        \n        for (int j = 0; j < maxBits; ++j) {\n            prefix[0][j] = (nums[0] >> j) & 1;\n        }\n        \n        for (int i = 1; i < n; ++i) {\n            for (int j = 0; j < maxBits; ++j) {\n                prefix[i][j] = prefix[i-1][j] + ((nums[i] >> j) & 1);\n            }\n        }\n        \n        ll count = 0;\n\n        for (ll i = 0; i < n; ++i) {\n            ll l = i, r = n - 1;\n            ll right = -1;\n            ll left = -1;\n\n            while (l <= r) {\n                ll mid = l + (r - l) / 2;\n                ll AND = 0;\n                for (ll j = 0; j < maxBits; ++j) {\n                    ll val = prefix[mid][j];\n                    if (i > 0) val -= prefix[i-1][j];\n                    if (val == mid - i + 1) AND |= (1 << j);\n                }\n                if (AND > k) l = mid +1;\n                else {\n                    if(AND==k) {\n                        right=mid;\n                        l=mid+1;\n                    }\n                    else r=mid-1;\n                }\n            }\n            \n            if (right == -1) continue;\n\n            l = i;\n            r = right;\n\n            while (l <= r) {\n                ll mid = l + (r - l) / 2;\n                ll AND = 0;\n                for (ll j = 0; j < maxBits; ++j) {\n                    ll val = prefix[mid][j];\n                    if (i > 0) val -= prefix[i-1][j];\n                    if (val == mid - i + 1) AND |= (1 << j);\n                }\n                if (AND > k) l = mid + 1;\n                else if(AND==k) {\n                    left=mid;\n                    r=mid-1;\n                }\n                else r = mid - 1;\n            }\n            // cout<<left<<\" \"<<right<<endl;\n            count += right - left + 1;\n        }\n        // cout<<endl;\n        return count;\n    }\n};\n",
    "submit_ts": "1720279488",
    "subm_id": "1311753206"
}