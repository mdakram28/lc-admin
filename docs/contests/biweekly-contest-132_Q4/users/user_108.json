{
    "username": "jason7708",
    "submission": "class Solution {\npublic:\n    int maximumLength(vector<int>& nums, int k) {\n        int n = nums.size();\n        vector<int> copy = nums;\n        ranges::sort(copy);\n        copy.erase(unique(copy.begin(), copy.end()), copy.end());\n        int m = copy.size();\n        int id = 0;\n        unordered_map<int, int> index;\n        for(int i=0; i<m; i++) {\n            index[copy[i]] = id++;\n        }\n\n        // vector<int> segtree(4*m, 0), tree_num(4*m, 0);\n        vector<vector<int>> segtree(k+1, vector<int>(4*m, 0));\n\n        auto update = [&] (int i, int l, int r, int pos, int val, int j, auto&& update) {\n            if(l == r) {\n                segtree[j][i] = val;\n                return;\n            }\n            int mid = l + (r - l) / 2;\n            if(pos <= mid) {\n                update(2*i+1, l, mid, pos, val, j, update);\n            }\n            else {\n                update(2*i+2, mid+1, r, pos, val, j, update);\n            }\n            segtree[j][i] = max(segtree[j][2*i+1], segtree[j][2*i+2]);\n            return;\n        };\n\n        auto query = [&] (int i, int l, int r, int L, int R, int j, auto&& query) {\n            if(L <= l && r <= R) {\n                return segtree[j][i];\n            }\n            int mid = l + (r - l) / 2;\n            int mx = 0;\n            if(L <= mid) {\n                mx = max(mx, query(2*i+1, l, mid, L, R, j, query));\n            }\n            if(R > mid) {\n                mx = max(mx, query(2*i+2, mid+1, r, L, R, j, query));\n            }\n            return mx;\n        };\n\n        for(int i=0; i<n; i++) {\n            for(int j=k; j>=0; j--) {\n                int mx = query(0, 0, m-1, index[nums[i]], index[nums[i]], j, query);\n                if(j > 0)\n                    mx = max(mx, query(0, 0, m-1, 0, m-1, j-1, query));\n                update(0, 0, m-1, index[nums[i]], mx + 1, j, update);\n            }\n        }\n        return query(0, 0, m-1, 0, m-1, k, query);\n    }\n};",
    "submit_ts": "1717860357",
    "subm_id": "1281754832"
}