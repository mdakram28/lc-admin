{
    "username": "JeffreyLC",
    "submission": "class SparseTable {\n public:\n    explicit SparseTable(const vector<int>& nums, const function<int(int, int)>& func, int init) : func_(func), init_(init) {\n        Build(nums);\n    }\n    \n    int Query(int lq, int rq) {\n        if (lq > rq) return init_;\n        int l = log2(rq - lq + 1);\n        return func_(sparse_table_[lq][l], sparse_table_[rq - (1 << l) + 1][l]);\n    }\n    \n private:\n    function<int(int, int)> func_;\n    int init_;\n    vector<vector<int>> sparse_table_;\n    \n    void Build(const vector<int>& nums) {\n        const int n = nums.size();\n        const int l = log2(n);\n        sparse_table_.resize(n);\n        for (int i = 0; i < n; ++i) {\n            sparse_table_[i].resize(l + 1, init_);\n        }\n        for (int i = 0; i < n; ++i) {\n            sparse_table_[i][0] = nums[i];\n        }\n        for (int j = 1; (1 << j) <= n; ++j) {\n            for (int i = 0; (i + (1 << j)) <= n; ++i) {\n                sparse_table_[i][j] = func_(sparse_table_[i][j - 1], sparse_table_[i + (1 << (j - 1))][j - 1]);\n            }\n        }\n    }\n};\n\nclass Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        const int n = nums.size();\n        SparseTable sparse_table = SparseTable(nums, [](int x, int y) -> int {\n            return (x & y);\n        }, INT_MAX);\n        long long ans = (nums[0] == k ? 1 : 0);\n        for (int r = 1; r < n; ++r) {\n            int x = 0, y = r;\n            while (x < y) {\n                int mid = (x + y) / 2;\n                int result = sparse_table.Query(mid, r);\n                if (result < k) {\n                    x = mid + 1;\n                } else {\n                    y = mid;\n                }\n            }\n            int l = x;\n            if (sparse_table.Query(x, r) != k) continue;\n            x = 0, y = r;\n            while (x < y) {\n                int mid = (x + y + 1) / 2;\n                int result = sparse_table.Query(mid, r);\n                if (result > k) {\n                    y = mid - 1;\n                } else {\n                    x = mid;\n                }\n            }\n            if (l <= x) {\n                ans += x - l + 1;\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1720277574",
    "subm_id": "1311670081"
}