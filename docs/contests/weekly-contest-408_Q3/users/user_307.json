{
    "username": "rqdmap",
    "submission": "const int maxn = 4e4 + 10;\n\nclass Solution {\n  vector<int> prefix;\n\npublic:\n  int query_one(int l, int r) {\n    l = max(0, l);\n    if (l > r) return 0;\n    if (l == 0)\n      return prefix[r];\n    return prefix[r] - prefix[l - 1];\n  }\n\n  int numberOfSubstrings(string s) {\n    prefix = vector<int>(s.size(), 0);\n\n    if (s[0] == '1')\n      prefix[0] = 1;\n    for (int i = 1; i < (int)s.size(); i++) {\n      prefix[i] = prefix[i - 1] + (s[i] == '1');\n    }\n\n    // \u7ef4\u62a4 200 + 5 \u4e2a 0 \u7684\u4f4d\u7f6e\u5373\u53ef\n    deque<int> dq;\n    dq.push_back(-1);\n\n    int ans = 0;\n    int n = (int)s.size();\n\t\tint K = sqrt(n) + 5;\n    for (int right = 0; right < n; right++) {\n      if (s[right] == '0') {\n        dq.push_back(right);\n        if (dq.size() > K) {\n          dq.pop_front();\n        }\n      }\n\n      // for (int i = (int)dq.size() - 1; i >= 0 && i >= (dq.size() - K); i--) {\n      for (int i = (int)dq.size() - 1; i >= 0; i--) {\n        int l, r;\n\n        if (i == (int)dq.size() - 1) {\n          // (dq[i], right] \u90fd\u662f\u53ef\u4ee5\u9009\u7684\u767d\u533a\n          ans += max(0, query_one(dq[i] + 1, right));\n        }\n\n        // \u4ece dq[i] \u7684\u4f4d\u7f6e\u5f00\u59cb\u5230 right \u7684\u4f4d\u7f6e, \u6709 dq.size() - i \u4e2a 0\n        int black_cnt = dq.size() - i;\n\n\n        if (i == 0) {\n          // [0, dq[i]) \u90fd\u662f\u53ef\u4ee5\u9009\u7684\u767d\u533a\n          r = dq[i] - 1;\n          l = r - max(0, black_cnt * black_cnt - query_one(r, right));\n          if (l >= 0) {\n            ans += l + 1;\n          }\n        } else {\n          // (dq[i - 1], dq[i]) \u662f\u53ef\u4ee5\u9009\u7684\u767d\u533a\n          r = dq[i] - 1;\n          l = r - max(0, black_cnt * black_cnt - query_one(r, right));\n          ans += max(0, l - dq[i - 1]);\n        }\n\n        if (dq[i] >= 0 && black_cnt * black_cnt <= query_one(dq[i], right)) {\n          ans += 1;\n        }\n\n\t\t\t\t// \u526a\u679d\n\t\t\t\tif(black_cnt * black_cnt >= right + 5) break;\n      }\n    }\n    return ans;\n  }\n};\n",
    "submit_ts": "1722138145",
    "subm_id": "1335783322"
}