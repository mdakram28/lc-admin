{
    "username": "user3304nA",
    "submission": "struct segtree {\n    int sz;\n    vector<long long> ands;\n    void init(int n) {\n        sz=1;\n        while (sz<n) sz*=2;\n        for (int i=0;i<2*sz;i++) ands.push_back((1LL<<31)-1);\n    }\n    \n    void set(int i, int v, int x, int lx, int rx) {\n        if (rx-lx==1) {\n            ands[x]=v;\n            return;\n        }\n        int mid=(lx+rx)/2;\n        if (i<mid) {\n            set(i,v,2*x+1,lx,mid);\n        }\n        else set(i,v,2*x+2,mid,rx);\n        ands[x]=ands[2*x+1]&ands[2*x+2];\n    }\n    \n    void set(int i, int v) {\n        set(i,v,0,0,sz);\n    }\n    \n    long long get(int l, int r, int x, int lx, int rx) {\n        if (l>=rx || lx>=r) return (1LL<<31)-1;\n        if (lx>=l && rx<=r) return ands[x];\n        int mid=(lx+rx)/2;\n        return get(l,r,2*x+1,lx,mid)&get(l,r,2*x+2,mid,rx);\n    }\n    \n    long long get(int l, int r) {\n        return get(l,r,0,0,sz);\n    }\n};\n\nclass Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        int n=nums.size();\n        segtree st;\n        st.init(n);\n        for (int i=0;i<n;i++) st.set(i,nums[i]);\n        long long ans=0;\n        for (int i=0;i<n;i++) {\n            if (nums[i]<k) continue;\n            int l=i;\n            int r=n-1;\n            int left=-1;\n            int right=-1;\n            while (l<=r) {\n                int mid=(l+r)/2;\n                long long cnt=st.get(i,mid+1);\n                if (cnt==k) {\n                    left=mid;\n                    r=mid-1;\n                }\n                else if (cnt<k) {\n                    r=mid-1;\n                }\n                else l=mid+1;\n            }\n            \n            l=i;\n            r=n-1;\n            while (l<=r) {\n                int mid=(l+r)/2;\n                long long cnt=st.get(i,mid+1);\n                if (cnt==k) {\n                    right=mid;\n                    l=mid+1;\n                }\n                else if (cnt<k) {\n                    r=mid-1;\n                }\n                else l=mid+1;\n            }\n            //cout<<i<<\" \"<<left<<\" \"<<right<<endl;\n            if (left!=-1 && right!=-1) ans+=right-left+1;\n        }\n        return ans;\n    }\n};",
    "submit_ts": "1720279489",
    "subm_id": "1311753256"
}