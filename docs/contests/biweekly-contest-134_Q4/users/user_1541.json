{
    "username": "beta-blue",
    "submission": "class Solution {\npublic:\n    long long countSubarrays(vector<int>& nums, int k) {\n        long long res = 0;\n        vector<int> bits(32, 0);\n        int l=-1;\n        int r=-1;\n        int cur = k;\n        bool reset = false;\n\n        for (int i=0; i<nums.size(); ++i) {\n            if ((nums[i] & k) != k)\n            {\n                if (reset)\n                {\n                    l = r = -1;\n                    resetBits(bits);\n                    reset = false;\n                }\n            } else {\n                int n = l == -1 ? 1 : (i - r + 1);\n                reset = true;\n                cur = andV(bits, nums[i], n);\n                if (cur != k) {\n                    if (l == -1) {\n                        l = r = i;\n                    }\n                } else {\n                    if (l == -1)\n                        l = r = i;\n\n                    while (r < i) {\n                        cur = remove(bits, nums[r], --n);\n                        if (cur != k) {\n                            cur = andV(bits, nums[r], ++n);\n                            break;\n                        }\n\n                        r++;\n                    }\n\n                    res += r - l + 1;\n                }\n                // cout << res << \" \" << l << \" \" << r << \" \" << i << \" \" << cur << \" \" << n << endl;\n            }\n            \n        }\n\n        return res;\n    }\n\n    void resetBits(vector<int>& bits) {\n        for (auto& i: bits)\n            i = 0;\n    }\n\n    int remove(vector<int>& bits, int val, int n) {\n        int res = 0;\n        for (int i=0; i<32; ++i) {\n            int mask = 1 << i;\n            if (val & mask) {\n                bits[i]--;\n            }\n\n            if (bits[i] == n)\n                res |= mask;\n        }\n\n        return res;\n    }\n\n    int andV(vector<int>& bits, int val, int n) {\n        int res = 0;\n        for (int i=0; i<32; ++i) {\n            int mask = 1 << i;\n            if (val & mask)\n            {\n                bits[i]++;\n                if (bits[i] == n)\n                    res |= mask;\n            }\n        }\n\n        return res;\n    }\n};",
    "submit_ts": "1720281084",
    "subm_id": "1311812576"
}