{
    "username": "cyzh",
    "submission": "#define debug(a) cout << #a << \" = \" << a << endl;\n#define debug2(a,b) cout<<#a<<\" = \"<<a<<' '<<#b<<\" = \"<<b<<endl;\n#define debug3(a,b,c) cout<<#a<<\" = \"<<a<<' '<<#b<<\" = \"<<b<<' '<<#c<<\" = \"<<c<<endl;\n#define debug4(a,b,c,d) cout<<#a<<\" = \"<<a<<' '<<#b<<\" = \"<<b<<' '<<#c<<\" = \"<<c<<' '<<#d<<\" = \"<<d<<endl;\n#define debugx(a, idx) cout << #a << \"[\" << idx << \"] = \" << a[idx] << endl;\n#define debugpii(a) cout<<#a<<\" = \"<<a.first<<\", \"<<a.second<<endl;\n#define debugarr(a, x) cout<<#a<<\": \"; for(int i = 0; i < x; i++) cout << a[i] << ' '; cout << endl;\n#define debugarr2(a, n, m) cout<<#a<<\": \\n\";for(int i=0;i<n;i++){for(int j=0;j<m;j++)cout<<a[i][j]<<' ';cout<<'\\n';}\n#define debugvec(a) cout<<#a<<\": \"; for(int i = 0; i < a.size(); i++) cout << a[i] << ' '; cout << endl;\n#define debugque(a) {cout<<#a<<\": \";auto TMP=a;while(TMP.size()){cout<<TMP.front()<<' ';TMP.pop();}cout<<endl;}\n#define debugstk(a) {cout<<#a<<\": \";auto TUP=a;while(TUP.size()){cout<<TUP.top()<<' ';TUP.pop();}cout<<endl;}\n#define rep(i,a,n) for (int i=a;i<n;i++)\n#define per(i,a,n) for (int i=n-1;i>=a;i--)\n#define pb push_back\n#define all(x) (x).begin(),(x).end()\n#define fi first\n#define se second\n#define SZ(x) ((int)(x).size())\ntypedef vector<int> vi;\ntypedef long long ll;\ntypedef pair<int,int> pii;\nconst ll mod=1000000007;\nll qpow(ll a,ll b) {ll res=1;a%=mod; for(;b;b>>=1){if(b&1)res=res*a%mod;a=a*a%mod;}return res;}\nll gcd(ll a,ll b) { return b?gcd(b,a%b):a;}\ntemplate <class T> bool chkmin(T& a, const T& b) { return b < a ? a = b, 1 : 0; }\ntemplate <class T> bool chkmax(T& a, const T& b) { return a < b ? a = b, 1 : 0; } \nclass Solution {\npublic:\n    vector<int> countOfPeaks(vector<int>& nums, vector<vector<int>>& queries) {\n        int n = nums.size();\n        vector<ll> szsz(n + 2);\n        auto lowbit = [](int x){ return x & -x;};\n        //\u5c06\u5e8f\u5217\u4e2d\u7b2cx\u4e2a\u6570\u52a0\u4e0ak\u3002\n        auto add = [&](int x, int k){ for(int i = x; i <= n; i += lowbit(i)) szsz[i] += k; };\n        //\u67e5\u8be2\u5e8f\u5217\u524dx\u4e2a\u6570\u7684\u548c\n        auto ask = [&](int x){ ll sum = 0; for(int i = x; i; i -= lowbit(i)) sum += szsz[i]; return sum;};\n        auto askq = [&](int l, int r){return ask(r) - ask(l - 1);};\n        \n        vector<int> arr(n, 0);\n        for(int i = 1; i + 1 < n; i++) {\n            if(nums[i] > nums[i - 1] && nums[i] > nums[i + 1]) {\n                add(i, 1);\n                arr[i] = 1;\n            }\n        }\n        vector<int> ans;\n        for(auto v : queries) {\n            int op = v[0], a = v[1], b = v[2];\n            if (op == 1) {\n                if (a == b) ans.push_back(0);\n                else {\n                    ll t = askq(a + 1, b - 1);\n                    ans.push_back(t);\n                }\n            }\n            else if (op == 2) {\n                if (a > 1) {\n                    int p1 = (nums[a - 1] > nums[a - 2]) && (nums[a - 1] > b);\n                    \n                    add(a - 1, p1 - arr[a - 1]);\n                    arr[a - 1] = p1;\n                }\n                if (a > 0 && a < n - 1) {\n                    int p1 = (b > nums[a - 1]) && (b > nums[a + 1]);\n                    \n                    add(a, p1 - arr[a]);\n                    arr[a] = p1;\n                    \n                }\n                if (a < n - 2) {\n                    int p1 = (nums[a + 1] > nums[a + 2]) && (nums[a + 1] > b);\n                    \n                    add(a + 1, p1 - arr[a + 1]);\n                    arr[a + 1] = p1;\n                }\n                nums[a] = b;\n            }\n        }\n        return ans;\n    }\n};",
    "submit_ts": 1718507497.0
}